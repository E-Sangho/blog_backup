I"‰b<h2 id="12-views-api">12 VIEWS API</h2>

<h3 id="120-register-view-controller">12.0 Register View Controller</h3>

<p>ì˜ìƒ ì¡°íšŒìˆ˜ë¥¼ ê¸°ë¡í•˜ëŠ” ê²ƒì„ ë§Œë“¤ì–´ë³´ê² ë‹¤. ì˜ìƒì„ ì‹œì²­í•  ë•Œë§ˆë‹¤ ë°±ì—”ë“œì— ìš”ì²­ì„ ë³´ë‚´ê³ , í•´ë‹¹ idì˜ ì¡°íšŒìˆ˜ë¥¼ ì˜¬ë ¤ì¤€ë‹¤. ê·¸ ì „ì— ìš°ë¦¬ê°€ ë§Œë“¤ ìƒˆë¡œìš´ viewsë¥¼ ì´í•´í•´ì•¼ í•œë‹¤. í˜„ì¬ ìš°ë¦¬ ì½”ë“œë¥¼ ë³´ë©´ ì„œë²„ì—ì„œ viewsë¡œ í˜ì´ì§€ë¥¼ ëœë”ë§í•´ì£¼ê³  ìˆë‹¤. ê·¸ëŸ°ë° ëŒ€ë¶€ë¶„ì˜ í˜ì´ì§€ëŠ” ì´ëŸ°ì‹ìœ¼ë¡œ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤. ìš”ì¦˜ ë°±ì—”ë“œëŠ” í…œí”Œë¦¿ì€ ëœë”ë§í•˜ì§€ ì•ŠëŠ”ë‹¤. ë°±ì•¤ë“œëŠ” ì¸ì¦, DBë¥¼ ë‹´ë‹¹í•˜ê³ , í”„ë¡ íŠ¸ì—”ë“œëŠ” React ë“±ìœ¼ë¡œ ë§Œë“ ë‹¤. í˜„ì¬ ìš°ë¦¬ NodejsëŠ” í˜ì´ì§€ê¹Œì§€ ëœë”ë§í•˜ê³  ìˆëŠ”ë° ì´ë¥¼ ë°”ê¿”ë³´ë ¤ê³  í•œë‹¤. ê·¸ë˜ì„œ í…œí”Œë¦¿ì„ ëœë”ë§í•˜ì§€ ì•ŠëŠ” viewsë¥¼ ë§Œë“¤í…ë° ì´ë¥¼ api viewsë¼ê³  í•œë‹¤.</p>

<p>ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ê°€ ì•„ëŠ” ì§€ì‹ìœ¼ë¡œ ì¡°íšŒìˆ˜ë¥¼ ì˜¬ë ¤ì£¼ëŠ” ê¸°ëŠ¥ì„ ë§Œë“œë ¤ê³  í•´ë³´ì. routersì— ìƒˆë¡œìš´ apiRouter.js íŒŒì¼ì„ ë§Œë“ ë‹¤. ê·¸ë¦¬ê³  ê·¸ ì•ˆì— ìƒˆë¡œìš´ ë¼ìš°í„°ë¥¼ ë§Œë“¤ê³  server.jsì—ì„œ íŠ¹ì • ì£¼ì†Œë¡œ ë“¤ì–´ê°€ë©´ ê·¸ ë¼ìš°í„°ë¥¼ ì“¸ ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. ë‹¤ìŒìœ¼ë¡œ í•´ë‹¹ ë¼ìš°í„°ì—ì„œ ì‚¬ìš©í•  ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“ ë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë¹„ë””ì˜¤ì˜ idë¡œ ì˜ìƒì„ ì°¾ì•„ì„œ ë¹„ë””ì˜¤ê°€ ì—†ë‹¤ë©´ ì˜¤ë¥˜ë¥¼ ë³´ë‚´ê³ , ìˆë‹¤ë©´ ì¡°íšŒìˆ˜ë¥¼ +1 í•œ ë‹¤ìŒ ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì„ í•  ê²ƒì´ë‹¤. ì—¬ê¸°ê¹Œì§€ì˜ ê³¼ì •ì„ ì½”ë“œë¡œ ë§Œë“¤ë©´ ì•„ë˜ì²˜ëŸ¼ ëœë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// server.js
import apiRouter from "./routers/apiRouter";
...
app.use("/api", apiRouter);
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// apiRouter.js
import express from "express";
import { registerView } from "../controllers/videoController";

const apiRouter = express.Router();

apiRouter.post("/videos/:id([0-9a-f]{24})/view", registerView);

export default apiRouter;
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// videoController.js
export const registerView = async (req, res) =&gt; {
  const { id } = req.params;
  const video = await Video.findById(id);
  if (!video) {
    return res.status(404);
  }
  video.meta.views = video.meta.views + 1;
  await video.save();
  return res.status(200);
};
</code></pre></div></div>

<p>ì—¬ê¸°ê¹Œì§€ëŠ” ì „í˜€ ì–´ë µì§€ ì•Šë‹¤. ë¬¸ì œëŠ” ì´ë¥¼ ì–´ë–»ê²Œ ì‘ë™ì‹œí‚¬ì§€ë‹¤. ì•ì„œ ë§í–ˆë“¯ì´ ìš°ë¦¬ëŠ” í˜ì´ì§€ë¥¼ ëœë”ë§í•˜ì§€ ì•Šê³  ì¡°íšŒìˆ˜ë¥¼ ì˜¬ë ¤ì£¼ê³  ì‹¶ë‹¤. ìš°ë¦¬ê°€ ì•„ëŠ” ë°©ì‹ìœ¼ë¡œ POSTë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ formì„ ë§Œë“¤ì–´ì„œ ì œì¶œí•´ì¤˜ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì´ ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ urlì´ ì´ë™í•´ì•¼ í•˜ëŠ” ë¬¸ì œì ì´ ìˆë‹¤. ë‹¤ì‹œ ë§í•´ ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ê°€ ì‚¬ìš©í•œ ë°©ë²•ìœ¼ë¡œëŠ” urlì„ ì´ë™í•˜ì§€ ì•Šê³  ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.</p>

<p>urlì„ ë°”ê¾¸ì§€ ì•Šê³  ì‚¬ìš©í•˜ëŠ” ê²½ìš°ëŠ” êµ‰ì¥íˆ ë§ë‹¤. ìš°ë¦¬ê°€ ëŒ“ê¸€ì„ ë‹¬ ë•Œë‚˜ ì˜ìƒì„ ì‹œì²­í•  ë•Œ, urlì€ ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ì²˜ëŸ¼ urlì´ ë³€í•˜ì§€ ì•Šê³  ì‘ë™í•˜ëŠ” ê²ƒì„ interactivityë¼ê³  í•œë‹¤. ë‹¤ìŒì—ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì–´ë–»ê²Œ urlì„ ë³€ê²½ì‹œí‚¤ì§€ ì•Šê³  ì´ëŸ° ì¼ì´ ê°€ëŠ¥í•œì§€ ì•Œì•„ë³´ì.</p>

<h3 id="121-register-view-event">12.1 Register View Event</h3>

<p>videoPlayer.jsì— urlì„ ë³€ê²½ì‹œí‚¤ì§€ ì•Šê³  ì‘ë™í•˜ë„ë¡ ì½”ë“œë¥¼ ë§Œë“œë ¤ê³  í•œë‹¤. ìš°ë¦¬ëŠ” ë¹„ë””ì˜¤ê°€ ëë‚  ë•Œ, ì¡°íšŒìˆ˜ë¥¼ ì˜¬ë ¤ì£¼ê¸° ìœ„í•´ì„œ â€œendedâ€ ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•´ì„œ handleEnded()ë¥¼ ë§Œë“œë ¤ê³  í•œë‹¤. ì´ëŠ” fetchë¥¼ ì‚¬ìš©í•˜ë©´ í•  ìˆ˜ ìˆì§€ë§Œ, ê·¸ ì „ì— ì˜ìƒì˜ _idê°€ í•„ìš”í•˜ë‹¤. _idëŠ” ê°„ë‹¨íˆ htmlì— <code class="language-plaintext highlighter-rouge">span=video._id</code> ê°™ì€ í˜•íƒœë¡œ ë§Œë“¤ ìˆ˜ë„ ìˆì§€ë§Œ, ì´ ê²½ìš° í˜ì´ì§€ì— _idê°€ ì§ì ‘ì ìœ¼ë¡œ ë³´ì´ê²Œ ëœë‹¤. ë‹¤í–‰íˆë„ í™”ë©´ì— ë³´ì´ì§€ ì•Šê²Œ ì¶”ê°€ ì •ë³´ë¥¼ ë‹´ì„ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆëŠ”ë°, data attributeë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤. data attributeì€ ì‚¬ìš©ë²•ì´ êµ‰ì¥íˆ ê°„ë‹¨í•œë°, <strong>data-</strong>ë¡œ ì‹œì‘í•˜ëŠ” ì†ì„±ìœ¼ë¡œ ì–´ë–¤ ê²ƒì´ë“  ë„£ì–´ë„ ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ <code class="language-plaintext highlighter-rouge">data-columns="3"</code>ì€ columns=â€3â€ì´ë¼ëŠ” ì •ë³´ë¥¼ ë„£ì–´ì¤€ ê²ƒì´ë‹¤. ìš°ë¦¬ì˜ ê²½ìš° _idë¥¼ ë³´ë‚´ì£¼ê³  ì‹¶ìœ¼ë¯€ë¡œ watch.pugë¥¼ ì•„ë˜ì²˜ëŸ¼ ê³ ì¹˜ì.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// watch.pug
block content
    div#videoContainer(data-id=video._id)
        ...
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  ì´ë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì½ëŠ” ë²•ì€ êµ‰ì¥íˆ ê°„ë‹¨í•œë°, .datasetì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤. datasetì€ data- ë’¤ì— ë¶™ì€ ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤. ì•„ë˜ ì˜ˆì‹œëŠ” data-ë¡œ ë³´ë‚¸ ì •ë³´ë“¤ì„ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ ë³´ì—¬ì¤€ë‹¤. <a href="https://developer.mozilla.org/ko/docs/Learn/HTML/Howto/Use_data_attributes">ë§í¬</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;article
  id="electriccars"
  data-columns="3"
  data-index-number="12314"
  data-parent="cars"&gt;
...
&lt;/article&gt;

var article = document.getElementById('electriccars');

article.dataset.columns // "3"
article.dataset.indexNumber // "12314"
article.dataset.parent // "cars"
</code></pre></div></div>

<p>ìš°ë¦¬ëŠ” data-idë¡œ ë„£ì—ˆìœ¼ë¯€ë¡œ, videoContainer.dataset.idì— ë¹„ë””ì˜¤ì˜ idê°€ ë“¤ì–´ ìˆë‹¤. ì´ì œ idë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë‹¤ìŒìœ¼ë¡œ í•´ë‹¹ idë¡œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.</p>

<p>ì´ì œ ì•Œì•„ë³¼ ê²ƒì€ <code class="language-plaintext highlighter-rouge">fetch(url [,options])</code>ë‹¤. fetchëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í˜ì´ì§€ ìƒˆë¡œ ê³ ì¹¨ ì—†ì´ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê³  ì •ë³´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤. urlì—ëŠ” ìš”ì²­ì„ ë³´ë‚¼ ì£¼ì†Œë¥¼ ì ê³ , optionsëŠ” method, body, header ë“± êµ‰ì¥íˆ ë§ì€ ì˜µì…˜ì´ ìˆë‹¤. ì´ë•Œ optionsë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ <code class="language-plaintext highlighter-rouge">method: "GET"</code>ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ë°, ìš°ë¦¬ëŠ” â€œPOSTâ€ê°€ í•„ìš”í•˜ë¯€ë¡œ ì´ ë¶€ë¶„ë§Œ ë°”ê¿”ì£¼ë©´ ëœë‹¤. fetchëŠ” promiseë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ ìˆœì„œê°€ ì¤‘ìš”í•˜ë©´ async/awaitì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// videoPlayer.js
const handleEnded = () =&gt; {
  const { id } = videoContainer.dataset;
  fetch(`/api/videos/${id}/view`, {
    method: "POST",
  });
};
...
video.addEventListener("ended", handleEnded);
</code></pre></div></div>

<h3 id="122-conclusions">12.2 Conclusions</h3>

<p>ì•ì„œ ë¹„ë””ì˜¤ì˜ idë¥¼ ê°€ì ¸ì˜¤ê³  fetchë¡œ í˜ì´ì§€ë¥¼ ëœë”ë§í•˜ì§€ ì•Šê³  ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸ í•´ì¤¬ë‹¤. ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ë¸Œë¼ìš°ì €ë¡œ ëŒì•„ê°€ì„œ inspect -&gt; Networkë¥¼ í™•ì¸í•˜ì. ë™ì˜ìƒì´ ëë‚  ë•Œ, ì—¬ê¸°ì— viewë¼ëŠ” ìš”ì²­ì´ ìƒê¸¸ ê²ƒì´ë‹¤. ë¬¸ì œëŠ” statusê°€ pendingì—ì„œ ë©ˆì¶°ìˆëŠ”ë°, ì´ëŠ” ìš°ë¦¬ê°€ return res.status()ë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì´ë‹¤. res.status()ëŠ” resì— statusë¥¼ ì¶”ê°€í•˜ëŠ” ì½”ë“œì¼ë¿, statusë¥¼ ë³´ë‚´ì£¼ëŠ” ì½”ë“œê°€ ì•„ë‹ˆë‹¤. ì§€ê¸ˆê¹Œì§€ëŠ” res.status().render() í˜•íƒœë¡œ ì‚¬ìš©í–ˆê³ , renderì´ ì•Œì•„ì„œ statusë¥¼ ë³´ë‚´ì¤¬ì§€ë§Œ, ìš°ë¦¬ëŠ” ì§€ê¸ˆ res.status()ë§Œ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ê·¸ë˜ì„œ statusê°€ ë³´ë‚´ì§€ì§€ ì•Šê³ , vidwê°€ pendingì—ì„œ ë©ˆì¶”ëŠ” ê²ƒì´ë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„  status ëŒ€ì‹ ì— sendStatus()ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.</p>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ í•œ ê°€ì§€ë§Œ ë” ì•Œì•„ë³´ì. ìš°ë¦¬ëŠ” ë¹„ë””ì˜¤ ì¡°íšŒìˆ˜ì— endedë¥¼ ì‚¬ìš©í–ˆëŠ”ë°, ìœ íŠœë¸ŒëŠ” timeupdateë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë” ì„ í˜¸í•œë‹¤. ì™œëƒí•˜ë©´ ì‚¬ìš©ìê°€ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ë´¤ëŠ”ì§€, ê·¸ë¦¬ê³  ì‚¬ìš©ìê°€ ì–´ë–¤ ì •ë³´ë¥¼ ë³´ë‚´ëŠ”ì§€ ìˆ˜ì§‘í•˜ê¸° ë•Œë¬¸ì´ë‹¤.</p>

<h2 id="13-video-recorder">13 VIDEO RECORDER</h2>

<h3 id="130-recorder-setup">13.0 Recorder Setup</h3>

<p>ë¹„ë””ì˜¤ ë…¹í™” ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ë³´ê² ë‹¤. íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ recorder.jsì— ì½”ë“œë¥¼ ì‘ì„±í• í…ë°, ê·¸ ì „ì— webpack.config.js íŒŒì¼ì—ì„œ íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ì•¼ í•œë‹¤. ì½”ë“œë¥¼ ì•„ë˜ì²˜ëŸ¼ ìˆ˜ì •í•´ì£¼ì.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// webpack.config.js
  entry: {
    main: "./src/client/js/main.js",
    videoPlayer: "./src/client/js/videoPlayer.js",
    // add recorder here
    recorder: "./src/client/js/recorder.js",
  },
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  pugì—ì„œ íŒŒì¼ì„ ì½ì–´ì˜¤ë„ë¡ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³ , ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¬ ë²„íŠ¼ì„ í•˜ë‚˜ ì¶”ê°€í•´ì¤€ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// upload.pug
block content
    div
        button#startBtn Start Recording
    ...

block scripts
    script(src="/static/js/recorder.js")
</code></pre></div></div>

<p>ì´ë ‡ê²Œí•˜ë©´ ê¸°ë³¸ì ì¸ ì¤€ë¹„ëŠ” ëë‚¬ë‹¤. <a href="https://developer.mozilla.org/ko/docs/Web/API/MediaDevices/getUserMedia">MediaDevices.getUserMedia()</a>ë¥¼ ë³´ë©´ ì–´ë–»ê²Œ ë¹„ë””ì˜¤ë¥¼ ë…¹í™”í•  ìˆ˜ ìˆëŠ”ì§€ ë‚˜ì˜¨ë‹¤. <code class="language-plaintext highlighter-rouge">navigator.mediaDeivces.getUserMedia(constraints)</code> êµ¬ì¡°ë¡œ ì‘ì„±í•  ìˆ˜ ìˆëŠ”ë°, ì—¬ê¸°ì„œ constraitsëŠ” ì˜ìƒ ì–´ë–»ê²Œ ë…¹í™”í• ì§€ ì§€ì •í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. <code class="language-plaintext highlighter-rouge">{ audio: true, video: true}</code>ë¡œ ë…¹ìŒ, ë…¹í™”ê°€ ê°€ëŠ¥í•˜ê²Œ ì§€ì •í•  ìˆ˜ ìˆê³ , <code class="language-plaintext highlighter-rouge">{ video: { width: 1280, height: 720 }}</code>ìœ¼ë¡œ ë…¹í™”í•˜ë ¤ëŠ” ì˜ìƒì˜ ì‚¬ì´ì¦ˆë¥¼ ì§€ì •í•˜ëŠ” ì¼ë„ ê°€ëŠ¥í•˜ë‹¤. í•˜ì§€ë§Œ ì§€ê¸ˆ ìš°ë¦¬ëŠ” ë‹¨ìˆœíˆ ë…¹í™”ë§Œ í•„ìš”í•˜ë¯€ë¡œ <code class="language-plaintext highlighter-rouge">{ audio: true, video: true}</code>ë§Œì„ ì‚¬ìš©í•˜ê² ë‹¤.</p>

<p>ê·¸ëŸ°ë° MediaDevices.getUserMediaëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ë¹„ë™ê¸°í•¨ìˆ˜ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ async/awaitì„ ì‚¬ìš©í•´ì„œ ì‘ì„±í•´ì¤˜ì•¼ í•œë‹¤. ë°˜í™˜í•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ëŠ” streamìœ¼ë¡œ ë°›ì•„ì„œ ì½˜ì†”ì— ì¶œë ¥í•´ì£¼ë„ë¡ ì½”ë“œë¥¼ ë§Œë“¤ì—ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// recorder.js
const startBtn = document.getElementById("startBtn");

const handleStart = async () =&gt; {
  const stream = await navigator.mediaDevices.getUserMedia({
    audio: true,
    video: true,
  });
  console.log(stream);
};

startBtn.addEventListener("click", handleStart);
</code></pre></div></div>

<p>ê·¸ëŸ°ë° ì´ë ‡ê²Œ ì‘ì„±í•˜ê³  ì¶œë ¥í•´ë³´ë©´ ì—ëŸ¬ê°€ ë‚˜ì˜¤ê²Œ ëœë‹¤. ê·¸ ì´ìœ ëŠ” í”„ë¡ íŠ¸ì—”ë“œì—ì„œëŠ” async/awaitì„ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. <a href="https://www.npmjs.com/package/regenerator-runtime">regenerator-runtime</a>ì„ <code class="language-plaintext highlighter-rouge">npm i regenerator-runtime</code>ë¡œ ì„¤ì¹˜í•œë‹¤. ì´ì œ ì´ íŒ¨í‚¤ì§€ë¥¼ importí•´ì•¼ í•˜ëŠ”ë°, ì„ íƒì§€ëŠ” 2ê°œê°€ ìˆë‹¤. í•˜ë‚˜ëŠ” recorder.jsì˜ ì œì¼ ìœ„ì— import í•´ì£¼ëŠ” ê²ƒì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” main.jsì—ì„œ importí•˜ê³  base.pugì—ì„œ main.jsë¥¼ importí•˜ëŠ” ê²ƒì´ë‹¤. ì „ìëŠ” í•„ìš”í•œ íŒŒì¼ì—ì„œ importí•˜ëŠ” ê²ƒì´ê³ , í›„ìëŠ” ëª¨ë“  íŒŒì¼ì—ì„œ importí•˜ëŠ” ê²ƒì´ë‹ˆ ì›í•˜ëŠ”ëŒ€ë¡œ ë§Œë“¤ì–´ì£¼ë©´ ëœë‹¤. ì—¬ê¸°ì„œëŠ” í›„ìë¡œ ë§Œë“¤ì–´ì¤¬ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// main.js
import "regenerator-runtime";
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// base.pug
script(src="/static/js/main.js")
    block scripts
</code></pre></div></div>

<h3 id="131-video-preview">13.1 Video Preview</h3>

<p>streamìœ¼ë¡œ ë°›ì•„ì˜¨ ê²ƒì„ ë³´ì—¬ì¤„ elementë¥¼ ë§Œë“¤ì–´ì£¼ê² ë‹¤. upload.pugì—ì„œ ì•„ë˜ì²˜ëŸ¼ ë§Œë“ ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// upload.pug
block content
    div
        // add preview
        video#preview
        button#startBtn Start Recording
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  recorder.jsì—ì„œ srcObjectë¥¼ ì¶”ê°€í•´ì£¼ê³ , ì¬ìƒí•´ì¤€ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// recorder.js
const video = document.getElementById("preview");

const handleStart = async () =&gt; {
  const stream = await navigator.mediaDevices.getUserMedia({
      ...
  });
  video.srcObject = stream;
  video.play();
};
</code></pre></div></div>

<p>ì´ë ‡ê²Œí•˜ë©´ í™”ë©´ì„ ë¯¸ë¦¬ë³¼ ìˆ˜ ìˆëŠ” ì°½ì´ ë§Œë“¤ì–´ì§„ë‹¤.</p>

<h3 id="132-recording-video">13.2 Recording Video</h3>

<p>ì´ë²ˆì—ëŠ” streamì„ ë…¹í™”í•´ë³´ê² ë‹¤. <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder">MediaRecorder</a>ë¥¼ ë³´ë©´ ì–´ë–»ê²Œ ë…¹í™”í•  ìˆ˜ ìˆëŠ”ì§€ ë‚˜ì™€ìˆë‹¤. <code class="language-plaintext highlighter-rouge">new MediaRecorder(stream [, options])</code>ë¡œ MediaRecorder ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆëŠ”ë°, streamì—ëŠ” ë…¹í™”í•˜ê³  ì‹¶ì€ ëŒ€ìƒì´ ë“¤ì–´ê°„ë‹¤. optionsì—ëŠ” ì´ˆë‹¹ ë¹„íŠ¸ ê°™ì€ ë‚´ìš©ì´ ë“¤ì–´ê°€ëŠ”ë°, ìš°ë¦¬ì˜ ê²½ìš° ê°„ë‹¨í•œ ë…¹í™” ê¸°ëŠ¥ë§Œ í•„ìš”í•˜ë¯€ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê² ë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">new MediaRecorder()</code>ë¡œ ê°ì²´ë¥¼ ë§Œë“¤ì—ˆìœ¼ë©´, <code class="language-plaintext highlighter-rouge">MediaRecorder.start()</code>, <code class="language-plaintext highlighter-rouge">MediaRecorder.stop()</code>ìœ¼ë¡œ ë…¹í™”ë¥¼ ì‹œì‘í•˜ê³  ì¤‘ë‹¨í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ°ë° ìš°ë¦¬ëŠ” ì§€ê¸ˆ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ streamì´ handler ì•ˆì—ì„œ ìƒì„±ë˜ê³  ìˆë‹¤. ì´ ê²½ìš° streamì„ í•¨ìˆ˜ ë°–ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ë…¹í™”ë¥¼ ì‹œì‘í•˜ê±°ë‚˜ ë©ˆì¶”ëŠ”ë° ì–´ë ¤ì›€ì´ ìˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ streamì„ ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸í•œ ë‹¤ìŒì— ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  handleStartëŠ” ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ streamì„ ë§Œë“¤ ì´ìœ ê°€ ì—†ìœ¼ë¯€ë¡œ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë¶ˆëŸ¬ì™€ì§ˆ ë•Œ, ì‹¤í–‰ë˜ë„ë¡ ë°”ê¾¸ê³  ì´ë¦„ë„ initìœ¼ë¡œ ë°”ê¿”ì£¼ê² ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// recorder.js
let stream;

const init = async () =&gt; {
    stream = await navigator.mediaDevices.getUserMedia({
        ...
    })
    ...
};

init();
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  ê¸°ì¡´ì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ê³ ì³ì„œ ë…¹í™” ì‹œì‘ê³¼ ëì„ ì‘ë™ì‹œí‚¤ê² ë‹¤. ë§Œì•½ ë²„íŠ¼ì„ ë‘ ê°œë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì´ë²¤íŠ¸ë¥¼ ë‘ ê°œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ë©´ ë˜ì§€ë§Œ, ë³´í†µ ë…¹í™” ì‹œì‘ê³¼ ë…¹í™” ì¢…ë£Œ ë²„íŠ¼ì€ ê°™ì€ ë²„íŠ¼ì„ ì‚¬ìš©í•˜ë˜, í˜„ì¬ ìƒíƒœì— ë”°ë¼ ë™ì‘ ê¸°ëŠ¥ë§Œ ë‹¬ë¼ì§„ë‹¤. ì´ë¥¼ êµ¬í˜„í•˜ë ¤ë©´ addEventListenerê³¼ removeEventListenerë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p>

<p>ë¨¼ì € ë…¹í™” ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë²„íŠ¼ì— ì íŒ ê¸€ìë¥¼ ë°”ê¿”ì£¼ê³ , removeEventListenerë¡œ í˜„ì¬ ì´ë²¤íŠ¸ë¥¼ ì§€ì›Œì¤€ë‹¤. ê·¸ë¦¬ê³  addEventListenerë¡œ ë…¹í™” ì •ì§€ ì´ë²¤íŠ¸ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤. ì§€ê¸ˆì€ ê°„ë‹¨íˆ setTimeoustìœ¼ë¡œ ë…¹í™”ë¥¼ ì¢…ë£Œì‹œí‚¤ë„ë¡ ë§Œë“¤ê² ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// recorder.js

const handelStart = () =&gt; {
    startBtn.innerText = 'Stop Recording';
    startBtn.removeEventListener('click', handleStart);
    startBtn.addEventListener('click', handleStop);
    const recorder = new MediaRecorder(stream);
    recorder.start();
    setTimeout(() =&gt; {
        recorder.stop();
    }, 10000);
};

const handleStop = () =&gt; {
    startBtn.innerText = 'Start Recording';
    startBtn.removeEventListener("click", handleStop);
    startBtn.addEventListener("click", handleStart);
};
</code></pre></div></div>

<p>ì´ë•Œ, ë…¹í™”ê°€ recorder.stop()ìœ¼ë¡œ ë…¹í™”ê°€ ì¢…ë£Œë˜ë©´, dataavailable ì´ë²¤íŠ¸ê°€ ì‘ë™ëœë‹¤. ì—¬ê¸°ì„œ dataavailableì€ ë…¹í™”í•œ ë¹„ë””ì˜¤ë¥¼ ë‹´ê³  ìˆëŠ”ë°, MediaRecorder.ondataavailableì—ì„œ data ì†ì„±ìœ¼ë¡œ ë…¹í™”í•œ ì˜ìƒì„ ë‹¤ë£° ìˆ˜ ìˆê²Œ ëœë‹¤. ì½”ë“œ ìˆœì„œëŒ€ë¡œ ì •ë¦¬í•˜ìë©´ recorder.ondataavailableë¡œ ë‚˜ì¤‘ì— ë…¹í™”ê°€ ì¢…ë£Œë˜ë©´ í•  ì¼ì„ ë§Œë“ ë‹¤. ê·¸ë¦¬ê³  recorder.stop()ì´ ì‹¤í–‰ë˜ë©´ ì˜ìƒì´ dataavailableë¡œ ë„˜ì–´ê°€ê³  recorder.ondataavailableì—ì„œ ë§Œë“  ì½”ë“œê°€ ì‹¤í–‰ëœë‹¤. ì§€ê¸ˆì€ ì–´ë–¤ ë°ì´í„°ê°€ ë“¤ì–´ìˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ console.logë¡œ ë‚´ìš©ë“¤ì„ ì¶œë ¥ì‹œí‚¤ë„ë¡ ë§Œë“¤ì—ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// recorder.js
const handleStart = () =&gt; {
  startBtn.innerText = "Stop Recording";
  startBtn.removeEventListener("click", handleStart);
  startBtn.addEventListener("click", handleStop);
  const recorder = new MediaRecorder(stream);
  recorder.ondataavailable = (e) =&gt; {
    console.log("recording done");  // #3
    console.log(e);                 // #4
    console.log(e.data);            // #5
  };
  console.log(recorder);    // #1
  recorder.start();
  console.log(recorder);    // #2
  setTimeout(() =&gt; {
    recorder.stop();
  }, 10000);
};
</code></pre></div></div>

<p>ë…¹í™”ë¥¼ ì‹œì‘í•˜ë©´ ë¨¼ì € #1ì—ì„œ recorderì´ ì¶œë ¥ë˜ëŠ”ë°, state: â€œinactiveâ€ë¡œ ë‚˜ì˜¨ë‹¤. ê·¸ë¦¬ê³  #2ì—ì„œ state: â€œrecordingâ€ìœ¼ë¡œ ë°”ë€ë‹¤. 10ì´ˆê°€ ì§€ë‚˜ì„œ ë…¹í™”ê°€ ëë‚˜ë©´ #3ìœ¼ë¡œ ë…¹í™”ê°€ ì¢…ë£Œë˜ì—ˆë‹¤ëŠ” ë¬¸êµ¬ê°€ ë‚˜ì˜¤ê³ , #4ì—ì„œ BlobEventë¥¼ ì¶œë ¥í•œë‹¤. BlobEventì˜ ë‚´ìš© ì¤‘ data: Blobì˜ ë‚´ìš©ì´ #5ì—ì„œ ì¶œë ¥ë˜ê³  ì½”ë“œê°€ ì¢…ë£Œëœë‹¤.</p>

<h3 id="133-recording-video-part-two">13.3 Recording Video part Two</h3>

<p>ì´ì œ setTimeout()ì´ ì•„ë‹ˆë¼ ë²„íŠ¼ìœ¼ë¡œ recorder.stop()ì„ ì‹¤í–‰ì‹œí‚¤ë ¤ê³  í•œë‹¤. ê·¸ëŸ°ë° recorderì´ í•¨ìˆ˜ ì•ˆì—ì„œ ì„ ì–¸ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. ê·¸ë˜ì„œ recorderë¥¼ globalë¡œ ì„ ì–¸í–ˆë‹¤. ê·¸ë¦¬ê³  í•„ìš”ì—†ëŠ” console.log()ë“¤ì„ ì§€ì›Œì¤¬ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// recorder.js
const handleStop = () =&gt; {
  startBtn.innerText = "Start Recording";
  startBtn.removeEventListener("click", handleStop);
  startBtn.addEventListener("click", handleStart);
  recorder.stop();
};

const handleStart = () =&gt; {
  startBtn.innerText = "Stop Recording";
  startBtn.removeEventListener("click", handleStart);
  startBtn.addEventListener("click", handleStop);
  recorder = new MediaRecorder(stream);
  recorder.ondataavailable = (event) =&gt; {

  };
  recorder.start();
};
</code></pre></div></div>

<p>ì´ì œ ondataavailable ì•ˆì— ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤. ë…¹í™”ë¥¼ ë‹¤ í•œ ë‹¤ìŒì— ì˜ìƒì„ ë‹¤ìš´ë¡œë“œ í•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ê³  í•œë‹¤. ì´ë•Œ, ì‚¬ìš©í•˜ëŠ” ê²ƒì´ <a href="https://developer.mozilla.org/ko/docs/Web/API/URL/createObjectURL">URL.createObjectURL</a>ì´ë‹¤. URL.createObjectURLì€ ì£¼ì–´ì§„ ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ëŠ” URLì„ ë§Œë“œëŠ”ë°, ì´ ì£¼ì†ŒëŠ” ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë¸Œë¼ìš°ì €ì˜ ë©”ëª¨ë¦¬ ìœ„ì— ìˆëŠ” ê²ƒì´ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ createObjectURLì„ ë§ì´ ì‚¬ìš©í•˜ë©´ ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•´ì§€ê²Œ ëœë‹¤. ê·¸ë˜ì„œ êµ‰ì¥íˆ ë§ì€ ì˜ìƒì„ ì“´ë‹¤ë©´, <code class="language-plaintext highlighter-rouge">URL.revokeObjectURL()</code>ë¡œ ë©”ëª¨ë¦¬ë¥¼ í•´ì œí•´ì¤˜ì•¼ í•œë‹¤. ë¬¼ë¡  ë¶ˆëŸ¬ì˜¨ ì›¹í˜ì´ì§€ê°€ ì¢…ë£Œë˜ë©´ ë©”ëª¨ë¦¬ëŠ” í•´ì œë˜ì§€ë§Œ, ìµœì í™”ì™€ ì•ˆì „ì„±ì„ ìœ„í•´ URLì„ í•´ì œí•´ë„ ë  ë•Œ í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤. ìš°ë¦¬ëŠ” ê·¸ë¦¬ ê¸¸ì§€ ì•Šì€ ì˜ìƒì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê² ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// recorder.js
const handleStart = () =&gt; {
    ...
    recorder.ondataavailable = (event) =&gt; {
        const videoFile = URL.createObjectURL(event.data);
    };
    ...
};
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  videoì˜ srcì— videoFileì„ ì§€ì •í•´ì•¼ í•œë‹¤. ê·¸ëŸ°ë° ì´ì „ì— ìš°ë¦¬ëŠ” video.srcObjectë¡œ ì´ë¯¸ ë¹„ë””ì˜¤ë¥¼ ì§€ì •í–ˆì—ˆë‹¤. ë‘˜ì˜ ì°¨ì´ì ì€ srcObjectëŠ” ë¯¸ë””ì–´ ê°ì²´ë¥¼ ì§€ì •í•˜ê³  srcëŠ” urlì„ ì§€ì •í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ì‰½ê²Œ ë§í•´ srcëŠ” ì˜ìƒì˜ ì£¼ì†Œë¥¼ ë„£ì–´ì¤˜ì•¼ í•˜ê³ , srcObjectëŠ” MediaStream, Blob ë“±ì˜ ë¯¸ë””ì–´ ê°ì²´ë¥¼ ë„£ì–´ì¤˜ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤. ì—¬ë‹´ìœ¼ë¡œ ì˜¤ë˜ëœ ë¸Œë¼ìš°ì €ì˜ ê²½ìš° srcObjectë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ì„œ, MediaStream, Blob ë“±ì„ URL.createObjectURL()ë¡œ ë³€í™˜í•œ ë‹¤ìŒ srcì— ë„£ì–´ì¤˜ì•¼ í–ˆë‹¤. ê·¸ëŸ°ë° ìµœê·¼ì—ëŠ” srcObject ìì²´ì— ë°”ë¡œ ë„£ì„ ìˆ˜ ìˆë‹¤.</p>

<p>ì–´ì¨Œê±°ë‚˜ ìš°ë¦¬ëŠ” srcObjectë¥¼ ì´ˆê¸°í™” ì‹œí‚¤ê³ , srcì— videoFileì„ ë„£ì–´ì£¼ë©´ ëœë‹¤. ì´ë•Œ, ì˜ìƒì„ ë³´ê¸° í¸í•˜ë„ë¡ video.loop = trueë¥¼ ì¶”ê°€í•´ì„œ ê³„ì† ì¬ìƒë˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// recorder.js
const handleStart = () =&gt; {
    ...
    recorder.ondataavailable = (event) =&gt; {
      const videoFile = URL.createObjectURL(event.data);
      video.srcObject = null;
      video.src = videoFile;
      video.loop = true;
      video.play();
    };
    ...
};
</code></pre></div></div>

<h3 id="134-downloading-the-file">13.4 Downloading the File</h3>

<p>ë‹¤ìŒìœ¼ë¡œ handleStop()ì—ì„œ ì˜ìƒì„ ë©ˆì·„ì„ ë•Œ, ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ ë°”ê¿”ë³´ê² ë‹¤. ê·¸ëŸ°ë° videoFileì„ ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ globalë¡œ ì„ ì–¸í•´ì¤€ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// recorder.js
let videofile;

const handleStop = () =&gt; {
  startBtn.innerText = "Download Recording";
  startBtn.removeEventListener("click", handleStop);
  startBtn.addEventListener("click", handleDownload);
  recorder.stop();
};

const handleStart = () =&gt; {
    ...
    videoFile = URL.createObjectURL(event.data);
    ...
</code></pre></div></div>

<p>ì´ì œ ìš°ë¦¬ëŠ” handleDownloadë¥¼ ë§Œë“¤ì–´ì„œ videoFileì„ ë‹¤ìš´ ë°›ìœ¼ë©´ ëœë‹¤. ì´ì œ ìš°ë¦¬ê°€ ë§Œë“  ì˜ìƒì„ ë‹¤ìš´ ë°›ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì. <a>ëŠ” ë‹¤ë¥¸ urlë¡œ ì—°ê²°í•  ìˆ˜ ìˆëŠ” ë§í¬ë¥¼ ë§Œë“ ë‹¤. ê·¸ëŸ°ë° ì—¬ê¸°ë‹¤ê°€ download ì†ì„±ì„ ì£¼ë©´, urlë¡œ ì´ë™í•˜ëŠ” ëŒ€ì‹ ì— í•´ë‹¹ urlì˜ íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ì°½ì„ ì—°ë‹¤. ê·¸ë¦¬ê³  downloadì— ê°’ì„ ì •í•˜ë©´ ì´ë¥¼ ë‹¤ìš´ë¡œë“œí•  ë•Œ, ì‚¬ìš©í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ì“°ê²Œ ëœë‹¤.</a></p>

<p>ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì„ ë§Œë“œëŠ” ìˆœì„œëŠ” createElementë¡œ <a>ë¥¼ ë§Œë“ ë‹¤. ê·¸ë¦¬ê³  <a>ì— href, download ì†ì„±ì„ ì£¼ê³ , document.body.appendChild(a)ë¡œ aë¥¼ bodyì— ë§Œë“¤ì–´ì¤€ë‹¤. ê·¸ë¦¬ê³  a.click()ìœ¼ë¡œ ë²„íŠ¼ì„ ëˆ„ë¥¸ íš¨ê³¼ê°€ ë‚˜íƒ€ë‚˜ê²Œ í•œë‹¤.</a></a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// recorder.js
const handleDownload = () =&gt; {
  const a = document.createElement("a");
  a.href = videoFile;
  a.download = "MyRecording.webm";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
};
</code></pre></div></div>

<h3 id="135-recap">13.5 Recap</h3>

<h2 id="14-webassembly-video-transcode">14 WEBASSEMBLY VIDEO TRANSCODE</h2>

<h3 id="140-introduction">14.0 Introduction</h3>

<p>ì˜ìƒì„ ë…¹í™”í•˜ê³  ë‹¤ëˆ™ë¡œë“œí•´ì„œ webm íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê¸°ëŠ¥ê¹Œì§€ëŠ” êµ¬í˜„í–ˆë‹¤. ë¬¸ì œëŠ” ì˜ìƒì„ ë³´ë©´ ì›€ì§ì´ì§€ë„ ì•Šê³ , ì‹œê°„ë„ ì—†ë‹¤. ê·¸ë˜ì„œ FFmpegë¥¼ ì‚¬ìš©í•´ì„œ mp4ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•ê³¼, ì¸ë„¤ì¼ì„ ë§Œë“œëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ê² ë‹¤.</p>

<p>FFmpegëŠ” ì¸ì½”ë”©ê³¼ ë””ì½”ë”©ì—ì„œ ê±°ì˜ í‘œì¤€ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ í”„ë¡œì íŠ¸ë¡œ, ìš°ë¦¬ê°€ ì•„ëŠ” ëŒ€ë¶€ë¶„ì˜ ë¹„ë””ì˜¤ ê´€ë ¨ í”„ë¡œê·¸ë¨ì´ ì‚¬ìš©í•˜ê³  ìˆë‹¤. FFmpegë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì½˜ì†”ì—ì„œ ffmpegë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ íŠœë¸Œ ì²˜ëŸ¼ í•˜ë‚˜ì˜ ì˜ìƒì„ ì¸ì½”ë”©í•´ì„œ ì—¬ëŸ¬ í™”ì§ˆë¡œ ë§Œë“¤ê³ , ì‚¬ìš©ìë“¤ì´ í™”ì§ˆì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤. ë¬¸ì œëŠ” ë¹„ìš©ì´ ë„ˆë¬´ ë§ì´ ë“ ë‹¤ëŠ” ì ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ 100ê°œì˜ 1GB ìš©ëŸ‰ì˜ ë¹„ë””ì˜¤ë¥¼ ì¸ì½”ë”©í•˜ë ¤ë©´ ì´ë¥¼ ìœ„í•œ ë©”ëª¨ë¦¬ì™€, ì—°ì‚° ëŠ¥ë ¥ì€ ìš°ë¦¬ê°€ ë¶€ë‹´í•˜ê¸°ì— ë„ˆë¬´ ë¹„ì‹¸ë‹¤.</p>

<p>ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ë°©ë²•ì´ WebAssemblyë‹¤. ì›¹ì–´ì…ˆë¸”ë¦¬ëŠ” í”„ë¡ íŠ¸ì—”ë“œì—ì„œ êµ‰ì¥íˆ ë¹ ë¥¸ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤. ë¬¼ë¡  ì›¹ì–´ì…ˆë¸”ë¦¬ë¥¼ ì§ì ‘ ë§Œë“¤ì§€ëŠ” ì•Šê³ , ëŒ€ë¶€ë¶„ì€ c, c++, RUSTë¡œ ë§Œë“¤ê²Œ ëœë‹¤. ìš°ë¦¬ì˜ ê²½ìš° ì›¹ì–´ì…ˆë¸”ë¦¬ë¥¼ ì§ì ‘ ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ì‚¬ëŒì´ ë§Œë“  ê²ƒì„ ì´ìš©í•œë‹¤.</p>

<p>ìš°ë¦¬ê°€ í•  ê²ƒì€ <a href="https://github.com/ffmpegwasm/ffmpeg.wasm">ffmpeg.wasm</a>ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤. <code class="language-plaintext highlighter-rouge">npm install @ffmpeg/ffmpeg @ffmpeg/core</code>ë¡œ ffmpeg.wasmì„ ì„¤ì¹˜í•´ì£¼ì.</p>

<h3 id="141-transcode-video">14.1 Transcode Video</h3>

<h3 id="142-download-transcoded-video">14.2 Download Transcoded Video</h3>

<h3 id="143-thumbnail">14.3 Thumbnail</h3>

<h3 id="144-recap">14.4 Recap</h3>

<h3 id="145-thumbnail-upload-part-one">14.5 Thumbnail Upload part One</h3>

<h3 id="146-thumbnail-upload-part-two">14.6 Thumbnail Upload part Two</h3>

<h2 id="15-flash-meddages">15 FLASH MEDDAGES</h2>

<h3 id="150-installation">15.0 Installation</h3>

<p>express-flash</p>

<h3 id="151-sending-messages">15.1 Sending Messages</h3>
:ET