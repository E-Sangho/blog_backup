---
layout: post
title: Youtube Clone2
date: Thu Oct 28 22:33:35 JST 2021
categories: Clone NodeJS
tag: Clone NodeJS
toc: true
---

## 6 MongoDB and Mongoose

### 6.0 Array Database part One
ì´ë²ˆì—ëŠ” ë¹„ë””ì˜¤ì— idë¥¼ ì¶”ê°€í•œ ë‹¤ìŒ ê·¸ idë¡œ ë§í¬ë¥¼ ë§Œë“¤ì–´ë³´ê² ë‹¤. ë¨¼ì € videoController.jsì— idë¥¼ í¬í•¨í•œ videosë¥¼ ë§Œë“¤ê³  ëª¨ë“  í˜ì´ì§€ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ ë°–ì—ì„œ ì„ ì–¸í•˜ê² ë‹¤.

```
// videoController.js
let videos = [
  {
    title: "First Video",
    rating: 5,
    comments: 2,
    createdAt: "2 minutes ago",
    views: 59,
    id: 1,
  },
  {
    title: "Second Video",
    rating: 5,
    comments: 2,
    createdAt: "2 minutes ago",
    views: 59,
    id: 2,
  },
  {
    title: "Third Video",
    rating: 5,
    comments: 2,
    createdAt: "2 minutes ago",
    views: 59,
    id: 3,
  },
];
```

ê·¸ë¦¬ê³  mixinì—ì„œ titleì„ ë§í¬ë¡œ ë°”ê¿”ì£¼ê² ë‹¤. ê·¸ë ‡ê²Œ í•˜ë ¤ë©´ ```a(href=`videos/${video.id}`)=video.title```ë¡œ ë°”ê¿”ì£¼ì•¼ í•œë‹¤. ì´ë•Œ ë°±í‹±ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²ƒì„ ìŠì§€ë§ì. ê·¸ ì™¸ì— mixin ì´ë¦„ì´ë‚˜ ê°ì²´ì˜ ì´ë¦„ì€ videoë¡œ ë°”ê¿”ì¤¬ë‹¤. ê·¸ë ‡ê²Œ í•˜ë©´ video.pug íŒŒì¼ì€ ì•„ë˜ì²˜ëŸ¼ ëœë‹¤.

```
// video.pug
mixin video(video)
    div
        h4
            a(href=`/videos/${video.id}`)=video.title
        ul
            li #{video.rating}/5.
            li #{video.comments} comments.
            li Posted #{video.createdAt}.
            li #{video.views} views.
```

ê·¸ì— ë§ì¶°ì„œ home.pugì—ë„ mixinì˜ ì´ë¦„ì„ ë°”ê¿”ì¤€ë‹¤.

```
// home.pug
block content
    h2 Welcome here you will see the trending videos
    each video in videos
        +video(video)
    else
        li Sorry nothing found.
```

ìš°ë¦¬ê°€ ë¹„ë””ì˜¤ì— idë¥¼ ë„£ì–´ì£¼ì—ˆê³  ê·¸ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ /videos/${video.id}ë¡œ ê°€ê²Œ ë§Œë“¤ì—ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ìš°ë¦¬ê°€ ìˆ˜ì •í•´ì•¼í•  ê²ƒì€ ì € ë§í¬ë¥¼ ëˆŒë €ì„ ë•Œ ê°€ê²Œ ë˜ëŠ” see ì»¨íŠ¸ë¡¤ëŸ¬ë‹¤. í•˜ê³  ì‹¶ì€ ì¼ì€ í˜„ì¬ ë§í¬ì˜ idì— ë§ì¶°ì„œ ë¹„ë””ì˜¤ê°€ ë‚˜ì˜¤ëŠ” ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ì•„ì§ ë¹„ë””ì˜¤ê°€ ì—†ìœ¼ë‹ˆ video.titleì´ ë‚˜ì˜¤ëŠ” ê²ƒìœ¼ë¡œ ë§Œë“¤ë„ë¡ í•˜ì.

ë¨¼ì € í˜„ì¬ idë¥¼ ë°›ì•„ì™€ì•¼ í•œë‹¤. videoRouterì—ì„œ ë³€ìˆ˜ë¥¼ idë¡œ ì •í–ˆê¸° ë•Œë¬¸ì— res.paramsì— ìˆëŠ” idë¥¼ ë°›ì•„ì™€ì•¼ í•œë‹¤. idë¥¼ ë°›ì•„ì˜¤ëŠ” ë°©ë²•ì€ 2ê°€ì§€ê°€ ìˆë‹¤. í•˜ë‚˜ëŠ” `const id = req.params.id;`ì´ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” `const { id } = req.params;`ë‹¤. ë‘ë²ˆì§¸ ê²ƒì€ ES6ë¶€í„° ì§€ì›ë˜ëŠ” ê²ƒì´ë‹ˆ ì‚¬ìš©í™˜ê²½ì— ë”°ë¼ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤. ìš°ë¦¬ëŠ” ES6ë¥¼ ì“´ë‹¤ê³  ìƒê°í•˜ê³  í›„ìë¥¼ ì‚¬ìš©í•˜ê² ë‹¤.

idë¥¼ ë°›ì•„ì™”ìœ¼ë©´ ì´ë¥¼ ê°€ì§€ê³  videosì—ì„œ ê°ì²´ë¥¼ ì°¾ì•„ì™€ì•¼ í•œë‹¤. videosì˜ idê°€ 1ë¶€í„° ì‹œì‘í–ˆë‹¤ê³  ìƒê°í•˜ë©´ `const video = videos[id-1]`ë¡œ videoë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ë ‡ê²Œ ë°›ì•„ì˜¨ ê²ƒì„ ëœë”ë§ìœ¼ë¡œ ë³´ë‚´ì£¼ë©´ ëœë‹¤. ```res.render("watch", { pageTitle: `Watching ${video.title}` })``` ë¼ê³  ì ì–´ì£¼ë©´ pageTitleì„ ì¶œë ¥í•´ì¤€ë‹¤. ì½”ë“œë¥¼ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```
// videoControllser.js
...
export const see = (req, res) => {
  const { id } = req.params;
  const video = videos[id - 1];
  return res.render("watch", { pageTitle: `Watching ${video.title}` , video });
};
...
```

### 6.1 Array Database part Two
seeë¼ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì´ë¦„ì´ ë§ì§€ ì•Šì•„ì„œ ì „ë¶€ watchë¡œ ë°”ê¿”ì¤¬ë‹¤. ì´ë²ˆì—ëŠ” watch.pug íŒŒì¼ì„ ë°”ê¿”ë³´ê² ë‹¤. ì—¬ê¸°ì„œ ìš°ë¦¬ëŠ” ë¹„ë””ì˜¤ë¥¼ ë³¸ íšŸìˆ˜ë¥¼ ì¶œë ¥í•˜ê³ , ê·¸ ë¹„ë””ì˜¤ë¥¼ ìˆ˜ì •í•˜ëŠ” ë§í¬ë¥¼ ê±¸ì–´ë†“ê² ë‹¤. ë¨¼ì € ì‹œì²­ íšŸìˆ˜ë¥¼ ë§Œë“¤ì–´ë³´ì. ê°„ë‹¨íˆ video.viewsë¥¼ ì“°ë©´ ë˜ì§€ë§Œ ë¬¸ì œëŠ” ë‹¨ìœ„ë‹¤. ë‹¨ìˆ˜ë¼ë©´ view ë³µìˆ˜ë¼ë©´ viewsë¥¼ ì¨ì•¼ í•˜ëŠ”ë°, ì´ë¥¼ ìœ„í•´ì„œ ì‚¼í•­ì—°ì‚°ìë¥¼ ì‚¬ìš©í–ˆë‹¤.

```
// watch.pug
...
block content
    h3 #{video.views} #{video.views === 1 ? : "view" : "views"}
```

ë‹¤ìŒìœ¼ë¡œ ë¹„ë””ì˜¤ë¥¼ ìˆ˜ì •í•˜ëŠ” ë§í¬ë¥¼ ë§Œë“¤ê¸° ì „ì—, ìƒëŒ€ê²½ë¡œì™€ ì ˆëŒ€ê²½ë¡œì˜ ì°¨ì´ë¥¼ ì•Œì•„ì•¼ í•œë‹¤. í˜„ì¬ ìœ„ì¹˜ëŠ” localhost:4000/videos/3ë¼ê³  í•˜ì. ì—¬ê¸°ì„œ href="/edit"ì„ ì‚¬ìš©í•˜ë©´ localhost:4000/editìœ¼ë¡œ ê°€ê²Œ ëœë‹¤. href="edit"ì„ ì‚¬ìš©í•˜ë©´ localhost:4000/videos/editìœ¼ë¡œ ê°„ë‹¤. ê·¸ ì´ìœ ëŠ” /ë¥¼ ì‚¬ìš©í•˜ë©´ í™ˆí™”ë©´ì„ ê¸°ì¤€ìœ¼ë¡œ ì¶œë°œí•´ì„œ /editìœ¼ë¡œ ê°€ê²Œ ë˜ê³ , /ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ í˜„ì¬ ìœ„ì¹˜ì˜ ë§ˆì§€ë§‰ ì¹¸ì„ editìœ¼ë¡œ ë°”ê¿”ì£¼ê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ëŸ°ë° ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê²ƒì€ ì ˆëŒ€ê²½ë¡œê°€ ì•„ë‹ˆë¼ ìƒëŒ€ê²½ë¡œì´ë¯€ë¡œ /ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹ ì— ìš°ë¦¬ëŠ” ë§ˆì§€ë§‰ urlì´ ë°”ë€ŒëŠ” ê²ƒë„ ê³ ë ¤í•´ì•¼ í•œë‹¤. video.idë¥¼ ê°™ì´ ì‚¬ìš©í•´ì•¼ ìš°ë¦¬ê°€ ì›í•˜ëŠ”ëŒ€ë¡œ urlì„ ì“¸ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ```a(href=`${video.id}/edit`) Edit Video &rarr;```ìœ¼ë¡œ ì ì–´ì•¼ í•œë‹¤.

```
// watch.pug
...
block content
    h3 #{video.views} #{video.views === 1 ? : "view" : "views"}
    a(href=`${video.id}/edit`) Edit Video &rarr; 
```

### 6.2 Edit Video Part One
ìš°ë¦¬ëŠ” videos/:id/editì— ê°€ëŠ” ë§í¬ë¥¼ ë§Œë“¤ì—ˆë‹¤. ì € ë¼ìš°í„°ì—ì„œ ì‘ë™í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” editì´ë¯€ë¡œ editì„ ë§Œë“¤ì–´ì£¼ì. ê¸°ë³¸ì ì¸ êµ¬ì¡°ëŠ” watchì™€ ë™ì¼í•˜ë‹¤.

```
// videoController.js
...
export const Edit = (req, res) => {
  const { id } = req.params;
  const video = videos[id - 1];
  return res.render("edit", { pageTitle: `Editing: ${video.title}`, video });
};
...
```

ê·¸ëŸ°ë° ë¼ìš°í„°ë‚˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì˜ˆì‹œë¥¼ ìœ„í•´ ë§Œë“  ê²ƒì´ ë§ì•„ì„œ í•„ìš” ì—†ëŠ” ê²ƒë“¤ì„ ì§€ì› ë”°. globalRouter.jsì—ì„œëŠ” /search ë¼ìš°í„°ë¥¼ ì§€ì› ê³ , videoRouter.jsì—ì„œëŠ” /upload ë¼ìš°í„°ë¥¼ ì§€ì›Œì¤¬ë‹¤. ê·¸ì— ë§ì¶° importë¥¼ ìˆ˜ì •í•˜ê³  ê° ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í•„ìš”ì—†ëŠ” ê²ƒë“¤ì„ ì§€ì› ë‹¤. ë‹¤ì‹œ ìš°ë¦¬ê°€ í•˜ë˜ ì¼ë¡œ ëŒì•„ê°€ì„œ ìš°ë¦¬ëŠ” editì„ ë§Œë“¤ì—ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ edit.pugë¥¼ ìˆ˜ì •í•´ì¤˜ì•¼ í•œë‹¤. ì´ë²ˆì— ë°°ìš¸ ê²ƒì€ GETê³¼ POSTì˜ ì°¨ì´ë‹¤. ìš°ì„  ì•„ë˜ì²˜ëŸ¼ ì½”ë“œë¥¼ ë§Œë“ ë‹¤.

```
// edit.pug
extends base.pug

block content
    h4 Change Title of video
    form(method="POST")
        input(name="title", placeholder="Video Title", value=video.title, required)
        input(value="Save",type="submit")
```

formì€ ì •ë³´ë¥¼ ì œì¶œí•˜ê¸° ìœ„í•œ ê²ƒë“¤ì„ í¬í•¨í•˜ëŠ” íƒœê·¸ë‹¤. formì€ actionê³¼ methodë¼ëŠ” ì†ì„±ì´ ìˆë‹¤. actionì€ í¼ì´ ì œì¶œë  ë•Œ ë°ì´í„°ë¥¼ ì „ë‹¬ë°›ëŠ” URLì˜ ì£¼ì†Œë¡œ, ì£¼ì†Œê°€ ì—†ìœ¼ë©´ í˜„ì¬ urlë¡œ ì œì¶œëœë‹¤. methodëŠ” HTTP methodë¥¼ ì˜ë¯¸í•˜ë©° POSTì™€ GETì´ ìˆë‹¤. GETì€ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì— ì‚¬ìš©í•˜ê³ , POSTëŠ” ë°ì´í„°ë² ì´ìŠ¤ê°€ ë³€ê²½ë  ê²½ìš° ì‚¬ìš©í•´ì•¼ í•œë‹¤. ì´ë¥¼ ì•Œê¸° ìœ„í•´ ë¨¼ì € GETìœ¼ë¡œ ë³´ë‚´ë³´ì. form(action="/save-changes")ë¡œ í•˜ê³  inputì— ì´ë¦„ì„ ë„£ì–´ì£¼ì. inputì— ì´ë¦„ì„ ë„£ì–´ì£¼ëŠ” ì´ìœ ëŠ” GET ë•Œë¬¸ì´ë‹¤. GETì€ actionì—ì„œ ì§€ì •í•œ urlë¡œ ê°€ê³  ?ë¥¼ ë¶™ì¸ë‹¤. ê·¸ë¦¬ê³  ? ë’¤ì— inputì—ì„œ ë°›ì€ ê°’ì„ ë„£ì–´ì£¼ëŠ”ë° ì´ë¦„ì´ ìˆì–´ì•¼ ê·¸ ê°’ì´ í‘œì‹œëœë‹¤.

```
// edit.pug
...
    form(action="/save-changes")
        input(name="title, placeholder="Video Title", value=video.title, required)
...
```

ê·¸ëŸ°ë° ë³´ë‹¤ì‹œí”¼ ìš°ë¦¬ê°€ ë°ì´í„°ë¥¼ ë³´ë‚´ë©´ ê·¸ ë°ì´í„°ê°€ urlì— ê·¸ëŒ€ë¡œ ë…¸ì¶œë˜ê¸° ëœë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ë³´ì•ˆì— ë¬¸ì œê°€ ìƒê¸°ê¸° ë•Œë¬¸ì—, ë°ì´í„°ë¥¼ ë³´ë‚¼ë•ŒëŠ” POSTë¡œ ë³´ë‚´ì„œ ë°ì´í„°ê°€ ìœ ì¶œë˜ì§€ ì•Šê²Œ í•´ì•¼ í•œë‹¤. POSTë¥¼ ì¨ì•¼ í•˜ëŠ” ì´ìœ ë¥¼ ì•Œì•˜ìœ¼ë¯€ë¡œ ì½”ë“œëŠ” ë‹¤ì‹œ ì›ë˜ëŒ€ë¡œ ë°”ê¿”ì¤€ë‹¤.

ìš°ë¦¬ëŠ” ì›¹ í˜ì´ì§€ì— ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë³´ë‚´ê³  ì‹¶ìœ¼ë¯€ë¡œ POSTë¥¼ ì‚¬ìš©í–ˆë‹¤. ê·¸ëŸ°ë° ë¼ìš°í„°ë¥¼ ë³´ë©´ GETë§Œì„ ë°›ì„ ë¿ ì•„ì§ POSTëŠ” ë°›ì§€ ëª»í•œë‹¤. ê·¸ëŸ¬ë¯€ë¡œ videoRouter.jsì— POSTë¥¼ ë°›ë„ë¡ ë§Œë“¤ì–´ì¤˜ì•¼ í•œë‹¤. ê·¸ëŸ°ë° ì´ë ‡ê²Œ ë˜ë©´ edití˜ì´ì§€ì— 2ê°œì˜ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë“¤ì–´ê°€ì•¼ í•œë‹¤. ê·¸ë˜ì„œ ê¸°ì¡´ì˜ editìœ¼ë¡œ ë§Œë“  ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì´ë¦„ì„ ìˆ˜ì •í•´ì„œ getEditìœ¼ë¡œ ë§Œë“¤ê³  ìš°ë¦¬ê°€ ë§Œë“¤ ìƒˆë¡œìš´ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” postEditìœ¼ë¡œ ë§Œë“¤ê² ë‹¤. ì´ë•Œ importì— ìˆëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì´ë¦„ë„ ë°”ê¿”ì¤˜ì•¼ í•˜ëŠ” ê²ƒì„ ê¸°ì–µí•˜ì.

```
// videoRouter.js
...
videoRouter.get("/:id(\\d+)/edit, getEdit);
videoRouter.post("/:id(\\d+)/edit, postEdit);
...
```

```
// videoController.js
...
export const getEdit = (req, res) => {
  const { id } = req.params;
  const video = videos[id - 1];
  return res.render("edit", { pageTitle: `Editing: ${video.title}`, video });
};
export const postEdit = (req, res) => {};
```

ì½”ë“œë¥¼ ìˆ˜ì •í•œ í›„ì— ë‹¤ì‹œ /videos/1/editì—ì„œ ì •ë³´ë¥¼ ë³´ë‚´ì£¼ë©´, í˜ì´ì§€ê°€ ì‘ë‹µí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì•„ì§ ìš°ë¦¬ëŠ” postEditìœ¼ë¡œ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë¡œë”©ë§Œ ê³„ì†ë  ê²ƒì´ë‹¤.

### 6.3 Edit Video Part Two
ìš°ë¦¬ëŠ” ê°™ì€ urlì— postì™€ getì„ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°, ì´ë¥¼ ê°„ë‹¨í•˜ê²Œ í•œ ì¤„ë¡œ ì¤„ì¼ ìˆ˜ ìˆë‹¤. ì•„ë˜ì˜ ë‘ ì½”ë“œëŠ” ë™ì¼í•œ ì¼ì„ í•œë‹¤.
```
videoRouter.get("/:id(\\d+)/edit, getEdit);
videoRouter.post("/:id(\\d+)/edit, postEdit);
```

```
videoRouter.route("/:id(\\d+)/edit").get(getEdit).post(postEdit);
```

ë‹¤ìŒìœ¼ë¡œ postEdit ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ìˆ˜ì •í•´ë³´ê² ë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‹¤í–‰ë˜ë©´ /videos/:idë¡œ ëŒì•„ê°€ê²Œ í•˜ë ¤ê³  í•œë‹¤. ì´ë•Œ ì‚¬ìš©ê°€ëŠ¥í•œ ê²ƒì´ res.redirect()ë¡œ, ì•ˆì— ê²½ë¡œë¥¼ ì ì–´ì£¼ë©´ ê·¸ ìœ„ì¹˜ë¡œ ê°€ê²Œ ëœë‹¤. idê°€ í•„ìš”í•˜ë¯€ë¡œ req.paramsì—ì„œ ë°›ì•„ì˜¤ê³  res.redirectë¡œ ê·¸ idì— í•´ë‹¹í•˜ëŠ” ë¹„ë””ì˜¤ë¡œ ëŒë ¤ë³´ë‚´ê² ë‹¤. ê·¸ í›„ req.bodyì—ì„œ titleì„ ë°›ì•„ì™€ì„œ ë¹„ë””ì˜¤ì˜ íƒ€ì´í‹€ì„ ìˆ˜ì •í•œë‹¤.

```
// videoController.js
...
export const postEdit = (req, res) => {
    const { id } = req.params;
    return res.redirect(`/videos/${id}`);
};
```

ê·¸ëŸ°ë° ìš°ë¦¬ëŠ” POSTëœ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ë°›ì•„ì˜¤ëŠ”ì§€ ëª¨ë¥¸ë‹¤. POSTëœ ì •ë³´ëŠ” req.bodyì— ë“¤ì–´ìˆë‹¤. ìš°ë¦¬ëŠ” titleì„ ë°›ì•„ì™€ì„œ ì´ë¦„ì„ ë°”ê¿”ì£¼ëŠ” ì¼ì„ í•˜ê³  ì‹¶ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì½”ë“œëŠ” ë‹¤ìŒì²˜ëŸ¼ ë  ê²ƒì´ë‹¤.

```
// videoController.js
...
export const postEdit = (req, res) => {
    const { id } = req.params;
    const { title } = req.body;
    videos[id - 1].title = title;
    return res.redirect(`/videos/${id}`);
};
```

í•˜ì§€ë§Œ ì„œë²„ë¥¼ ì—´ì–´ì„œ ìƒˆë¡œìš´ ì œëª©ì„ ì €ì¥í•´ë´ë„ ì œëª©ì´ ë°”ë€Œì§€ ì•ŠëŠ”ë‹¤. ê·¸ ì´ìœ ëŠ” expressê°€ formì„ ì–´ë–»ê²Œ ë‹¤ë£¨ëŠ”ì§€ ëª¨ë¥´ê¸° ë•Œë¬¸ì´ë‹¤. ì¦‰ ë°ì´í„°ë¥¼ ë³´ë‚´ì£¼ë”ë¼ë„ ì„œë²„ì—ì„œ í•´ì„ ê°€ëŠ¥í•œ í˜•íƒœê°€ ì•„ë‹ˆê¸°ì— ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. ê·¸ë˜ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ bodyParserë¡œ ë°ì´í„°ë¥¼ ê°€ê³µ(parsing)í•´ì„œ ì„œë²„ì—ì„œ ì´í•´í•  ìˆ˜ ìˆê²Œ ë°”ê¿”ì¤€ë‹¤. expressì˜ bodyParserëŠ” express.urlencodedë‹¤. bodyParserê°€ ë¼ìš°í„°ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ ì•„ë¬´ëŸ° ì´ìƒì—†ì´ ì‘ë™í•˜ë¯€ë¡œ server.jsì—ì„œ ë¼ìš°í„° ì•ì— ì½”ë“œë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤.

```
// server.js
...
app.use(express.urlencoded({ extended: true }));
app.use("/", globalRouter);
```

### 6.4 Recap

### 6.5 More Practice Part One

### 6.6 More Practice Part Two

### 6.7 Introduction to MongoDB
[MongoDB](https://docs.mongodb.com/manual/)ëŠ” NoSQL DBMSì˜ ì¼ì¢…ìœ¼ë¡œ, í¬ë¡œìŠ¤ í”Œë«í¼ ë„íë¨¼íŠ¸ ì§€í–¥ ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì´ë‹¤. ì •ì˜ë§Œ ë´ë„ ëª¨ë¥´ëŠ” ë‹¨ì–´ê°€ ë„ˆë¬´ ë§ì´ ë‚˜ì™€ì„œ í•˜ë‚˜í•˜ë‚˜ ì„¤ëª…ì´ í•„ìš”í•˜ë‹¤. ë¨¼ì € NoSQLì€ Not only SQLì˜ ì•½ìë¡œ SQLë§Œì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” DBMS(DataBase Management System)ì„ ë§í•œë‹¤. ì—¬ê¸°ì„œ SQL(Structed Query Languare)ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìë£Œ ì²˜ë¦¬ìš© ì–¸ì–´ë¡œ ì—ìŠ¤íì—˜, ì‹œí€„ì´ë¼ê³  ì½ëŠ”ë‹¤. SQLë¡œ ë°ì´í„°ë¥¼ ë‹¤ë£° ìˆ˜ ìˆì§€ë§Œ, MongoDBëŠ” NoSQLì´ë¯€ë¡œ SQLë„ ì‚¬ìš©í•˜ê³  ì¶”ê°€ë¡œ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤. ë³µì¡í•˜ì§€ë§Œ ê°„ë‹¨íˆ ë§í•´ MongoDBëŠ” JSON í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.

MongoDBë¥¼ ì„¤ì¹˜í•˜ë ¤ë©´ í™ˆí˜ì´ì§€ì—ì„œ Resources -> Server -> Installationì— ë“¤ì–´ê°„ë‹¤. ì´ê²ƒì €ê²ƒ ìˆì§€ë§Œ ìš°ë¦¬ê°€ ì‚¬ìš©í•  ê²ƒì€ ë¬´ë£Œë²„ì „ì¸ Community Editionì´ë‹¤. ê°ì OSì— ë”°ë¼ ì„¤ì¹˜ë²•ì´ ë‹¤ë¥´ì§€ë§Œ, ë§¥ì—ì„œëŠ” `xcode-select --install` `brew tap mongodb/brew` `brew install mongodb-community@5.0`ë¥¼ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•´ì£¼ë©´ ëœë‹¤. MongoDB ë²„ì „ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ë„ ìˆìœ¼ë‹ˆ í™ˆí˜ì´ì§€ì—ì„œ í™•ì¸í•˜ê³  ì„¤ì¹˜í•˜ì.

ë§ˆì§€ë§‰ìœ¼ë¡œ MongoDBë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ `brew services start mongodb-community@5.0`ë¥¼ ì…ë ¥í•´ì£¼ê³  ì¢…ë£Œí•˜ë ¤ë©´ `brew services stop mongodb-community@5.0`ë¥¼ ì…ë ¥í•˜ë©´ ëœë‹¤.

### 6.8 Connecting to Mongo
[mongoose](https://mongoosejs.com/)ëŠ” Node.jsì™€ MongoDBë¥¼ ì—°ê²°ì‹œì¼œì£¼ëŠ” ì¼ì„ í•œë‹¤. mongooseë¥¼ ì‚¬ìš©í•˜ë©´ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ MongoDBë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì—¬ëŸ¬ ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ìš°ì„  ì„¤ì¹˜í•œ MongoDBê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì. í„°ë¯¸ë„ì„ ì—´ì–´ì„œ `mongod`ë¥¼ ì…ë ¥í•˜ì. ê·¸ëŸ¬ë©´ ì—¬ëŸ¬ ì¤„ì´ ë‚˜ì˜¤ê²Œ ëœë‹¤. ì—ëŸ¬ë©”ì„¸ì§€ë§Œ ë‚˜ì˜¤ì§€ ì•ŠëŠ”ë‹¤ë©´ ë¬¸ì œ ì—†ë‹¤. í™•ì¸ë˜ì—ˆë‹¤ë©´ mongoë¼ê³  ì…ë ¥í•œë‹¤. ê·¸ëŸ¬ë©´ MongoDB shellì´ ì—´ë¦¬ê²Œ ë˜ëŠ”ë°, ì—¬ê¸°ë‹¤ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ MongoDBë¥¼ ë‹¤ë£° ìˆ˜ ìˆë‹¤. help, show dbs ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆìœ¼ë©´ í™•ì¸ì´ ëë‚¬ìœ¼ë¯€ë¡œ exitìœ¼ë¡œ ë‚˜ì™€ì¤€ë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ `npm i mongoose`ë¡œ mongooseë¥¼ ì„¤ì¹˜í•œë‹¤.

ì´ë²ˆì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ê² ë‹¤. server.js ì˜†ì— db.js íŒŒì¼ì„ í•˜ë‚˜ ë§Œë“ ë‹¤. ìš°ë¦¬ëŠ” ì»´í“¨í„°ì— ì‹¤í–‰ë˜ê³  ìˆëŠ” mongo databaseì— ì—°ê²°ì‹œì¼œì¤„ ê²ƒì´ë‹¤. ìš°ì„  mongooseë¥¼ importí•œë‹¤. `import mongoose from "mongoose";` ê·¸ í›„ urlê³¼ mongooseë¥¼ ì—°ê²°ì‹œí‚¨ë‹¤. ì—°ê²°ì‹œí‚¤ëŠ” ëª…ë ¹ì€ `mongoose.connect("url")`ë¡œ í•´ì£¼ë©´ ëœë‹¤. ì—¬ê¸°ì„œ urlì„ í™•ì¸í•˜ë ¤ë©´ í„°ë¯¸ë„ì—ì„œ `mongo`ë¥¼ ì…ë ¥í•œ í›„ì— ë‘ë²ˆì§¸ ì¤„ì— connecting to:ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë‚˜ ê°™ì€ ê²½ìš°ëŠ” mongodb://127.0.0.1:27017/ ì˜€ë‹¤. ì—¬ê¸°ë‹¤ê°€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§Œë“¤ë ¤ë©´ /ë’¤ì— ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„ì„ ì ì–´ì£¼ë©´ ëœë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„ìœ¼ë¡œ wetubeë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ë¯€ë¡œ, `mongoose.connect("mongodb://127.0.0.1:27017/wetube")`ë¥¼ ì…ë ¥í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ 
mongooseëŠ” wetubeë¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì—°ê²°ì‹œì¼œì¤€ë‹¤.

ê·¸ëŸ°ì— ì•„ì§ ì´ íŒŒì¼ì„ ì„œë²„ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆì§€ ì•Šìœ¼ë¯€ë¡œ ì—°ê²°ì‹œì¼œì¤˜ì•¼ í•œë‹¤. `import "./db";`ë¥¼ server.js íŒŒì¼ ì œì¼ ìœ„ì— ì ì–´ì£¼ë©´ ëœë‹¤. ê·¸ëŸ°ë° ì´ë ‡ê²Œ í•˜ê³  ë¡œê·¸ë¥¼ ë³´ë©´ ì—ëŸ¬ê°€ ë‚˜ì˜¨ë‹¤. ì •í™•íˆëŠ” ê²½ê³ ê°€ ë‚˜ì˜¤ëŠ”ë° { useNewUrlParser: true }ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ë¬¸ì¥ê³¼ { useUnifiedTopology: true }ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ë¬¸ì¥ì´ ë‚˜ì˜¨ë‹¤. ì´ ë‘ ë¬¸ì¥ì„ ë„£ì–´ì£¼ë©´ db.js íŒŒì¼ì€ ë‹¤ìŒì²˜ëŸ¼ ëœë‹¤.

```
// db.js
import mongoose from "mongoose";

mongoose.connect("mongodb://127.0.0.1:27017/wetube", {
  useNewUrlParser: true,
  useUnifiedTopology: true,
});
```

ë§ˆì§€ë§‰ìœ¼ë¡œ ì—°ê²° ì„±ê³µ ì—¬ë¶€ë¥¼ ì¶œë ¥í•´ì£¼ëŠ” ë¬¸ì¥ì„ ë§Œë“¤ì–´ì£¼ê² ë‹¤. ì—¬ê¸°ì„œ onê³¼ onceì˜ ì°¨ì´ëŠ” onì€ ì—¬ëŸ¬ ë²ˆ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , onceëŠ” í•œ ë²ˆë§Œ ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì´ë‹¤.

```
// db.js
...
const db = mongoose.connection;

const handleOpen = () => console.log("âœ… Connected to DB");
const handleError = (error) => console.log("âŒ DB Error", error);

db.on("error", handleError);
db.once("open", handleOpen);
```

### 6.9 CRUD Introduction
CRUDëŠ” ì»´í“¨í„° ì†Œí”„íŠ¸ì›¨ì–´ê°€ ì‚¬ìš©í•˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ë°ì´í„° ì²˜ë¦¬ ê¸°ëŠ¥ì¸ Create, Read, Update, Deleteë¥¼ ë¬¶ì–´ì„œ ì“°ëŠ” ë§ì´ë‹¤. ì•ìœ¼ë¡œëŠ” ìš°ë¦¬ê°€ ë§Œë“  ì½”ë“œì—ë„ CRUDë¥¼ ì ìš©ì‹œí‚¬ ê²ƒì´ë‹¤. ì¦‰ ë¹„ë””ì˜¤ë¥¼ ë§Œë“¤ê³ , ë¶ˆëŸ¬ì˜¤ê³ , ìˆ˜ì •í•˜ê³ , ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ì„ ë§Œë“ ë‹¤. ì§€ê¸ˆê¹Œì§€ëŠ” ì´ëŸ° ì¼ì„ ê°€ì§œ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì§„í–‰í–ˆì§€ë§Œ, ì´ë²ˆ ì¥ì—ì„œëŠ” ì§„ì§œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ìœ„ì˜ ì¼ì„ ì§„í–‰í•˜ê² ë‹¤.

ìš°ì„  srcì— modelsë¼ëŠ” í´ë”ë¥¼ ë§Œë“ ë‹¤. ê·¸ ì•ˆì— Video.jsë¼ëŠ” íŒŒì¼ì„ ë§Œë“¤ê³  ì—¬ê¸°ì— ë¹„ë””ì˜¤ì˜ ëª¨ë¸ì„ ë§Œë“ ë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„  mongooseì—ê²Œ ìš°ë¦¬ê°€ ì‚¬ìš©í•  ë°ì´í„°ê°€ ì–´ë–¤ ê²ƒì„ í¬í•¨í•˜ê³  ìˆëŠ”ì§€ ë§í•´ì¤˜ì•¼ í•œë‹¤. 

### 6.10 Video Model
ëª¨ë¸ì„ ë§Œë“¤ê¸° ì „ì— mongooseë¥¼ import í•´ì¤˜ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  ëª¨ë¸ì´ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€ë¥¼ ì •í•´ì•¼ í•˜ëŠ”ë° ì´ë¥¼ Schemaë¼ê³  í•œë‹¤. ìŠ¤í‚¤ë§ˆëŠ” ì–´ë–¤ ìë£Œê°€ ë“¤ì–´ê°€ê³ , ë˜ ê° ìë£Œì˜ ìë£Œí˜•ìœ¼ë¡œ í‘œí˜„ë˜ëŠ”ì§€ í‘œí˜„í•œ ê²ƒì´ë‹¤. ëª½êµ¬ìŠ¤ëŠ” ìŠ¤í‚¤ë§ˆë¥¼ ë°”íƒ•ìœ¼ë¡œ ë“¤ì–´ì˜¨ ë°ì´í„°ë¥¼ ê²€ì‚¬í•˜ê³ , ìŠ¤í‚¤ë§ˆì™€ ì–´ê¸‹ë‚˜ë©´ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¨ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ìŠ¤í‚¤ë§ˆì˜ í˜•íƒœì™€ ë§ì§€ ì•ŠëŠ” ë°ì´í„°ë¥¼ ê±°ë¥¼ ìˆ˜ ìˆë‹¤. ìŠ¤í‚¤ë§ˆë¥¼ ë§Œë“œëŠ” ë°©ë²•ì€ `new mongoose.Schema({});`ì•ˆì— ë§Œë“¤ì–´ì£¼ë©´ ëœë‹¤. ì´ë•Œ ê° ìë£Œì™€ ìë£Œí˜•ì„ í‘œí˜„í•´ì¤˜ì•¼ í•œë‹¤. ì•„ë˜ë¥¼ ë³´ë©´ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆë‹¤.

```
// Video.js
import mongoose from "mongoose";

const videoSchema = new mongoose.Schema({
    title: String,
    description: String,
    createdAt: Date,
    hashtags: [{ type: String }],
    meta: {
        views: Number,
        rating: Number,
    },
});
```

ìœ„ì—ì„œ metaë¥¼ ë³´ë©´ ìŠ¤í‚¤ë§ˆ ì•ˆì— ë˜ ìŠ¤í‚¤ë§ˆë¥¼ ì‘ì„±í–ˆëŠ”ë°, ì´ì²˜ëŸ¼ ìŠ¤í‚¤ë§ˆ ì•ˆì— ìŠ¤í‚¤ë§ˆë¥¼ ì“°ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤. ì´ë ‡ê²Œ ì‘ì„±í•œ ìŠ¤í‚¤ë§ˆë¥¼ ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ ë“±ë¡í•´ì¤˜ì•¼ í•œë‹¤. ì´ëŠ” `mongoose.model("[Name]", [schemaName])` í˜•íƒœë¡œ ì‘ì„±í•˜ëŠ”ë°, schemaNameì— ì‘ì„±í•œ ìŠ¤í‚¤ë§ˆì˜ ì´ë¦„ì„ ë„£ì–´ì£¼ê³  Nameì— ëª¨ë¸ì˜ ì´ë¦„ì„ ë„£ì–´ì£¼ë©´ ëœë‹¤. ëª½êµ¬ìŠ¤ëŠ” ëª¨ë¸ì˜ ì´ë¦„ìœ¼ë¡œ ì»¬ë ‰ì…˜ì„ ë§Œë“ ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ Nameì´ Videoë©´ ì»¬ë ‰ì…˜ì€ ì´ë¥¼ ì†Œë¬¸ìë¡œ ë°”ê¾¸ê³  ë³µìˆ˜í˜•ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ videosê°€ ëœë‹¤. ì´ë ‡ê²Œ ë§Œë“  íŒŒì¼ì„ ë‹¤ë¥¸ ê³³ì—ì„œ ë¶ˆëŸ¬ì™€ì•¼í•˜ê¸° ë•Œë¬¸ì— export í•´ì¤€ë‹¤.

```
// Video.js
...
const Video = mongoose.model("Video", videoSchema);

export default Video;
```

ë‹¤ìŒìœ¼ë¡œ server.jsì—ì„œ importí•´ì¤€ë‹¤. `import "./models/Video";`

```
// server.js
import "./db";
import "./models/Video";
import express from "express";
...
```

### 6.11 Our First Query
ìš°ë¦¬ëŠ” Video ëª¨ë¸ì„ ë§Œë“¤ì–´ì„œ server.js íŒŒì¼ì— import í•´ì£¼ì—ˆë‹¤. ê·¸ëŸ°ë° ì•ìœ¼ë¡œë„ ë§ì€ íŒŒì¼ë“¤ì„ import í• í…ë°, importëŠ” ì„œë²„ë¥¼ ë‹¤ë£¨ëŠ” ê²ƒì´ ì•„ë‹ˆë¯€ë¡œ server.jsì™€ ìƒê´€ì´ ì—†ëŠ” ë¶€ë¶„ì´ë‹¤. ê·¸ë˜ì„œ ë”°ë¡œ íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ import ë¶€ë¶„ì„ ë¶„ë¦¬ì‹œì¼œì£¼ê² ë‹¤. src í´ë”ì— init.js íŒŒì¼ì„ ìƒì„±í•œë‹¤. ì•ìœ¼ë¡œëŠ” ì´ íŒŒì¼ë¡œ ì„œë²„ë¥¼ ì‹œì‘í•  ê²ƒì´ë‹¤. ê·¸ë ‡ê²Œí•˜ë©´ server.jsëŠ” expressì— ê´€ë ¨ëœ ë¶€ë¶„ì„ ì‘ì„±í•˜ê³ , initì€ ì‹œì‘í•˜ëŠ”ë° í•„ìš”í•œ ê²ƒì„ ëª¨ì„ ê²ƒì´ë‹¤. ë¨¼ì € server.js íŒŒì´ë¥¼ ì‚´í´ë³´ì. ìµìŠ¤í”„ë ˆìŠ¤ì™€ ê´€ë ¨ëœ ë¶€ë¶„ë§Œ ë‚¨ê¸°ê¸°ë¡œ í–ˆìœ¼ë¯€ë¡œ, `import "./db"`, `import "./models/Video"`ëŠ” ìƒê´€ ì—†ëŠ” ë¶€ë¶„ì´ë‹¤. ë˜í•œ `app.listen()` ë˜í•œ ì„œë²„ë¥¼ ì‹œì‘í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ì„œë²„ìì²´ì™€ëŠ” ìƒê´€ ì—†ëŠ” ë¶€ë¶„ì´ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì´ì™€ ê´€ë ¨ëœ handleListeningê³¼ PORT ë¶€ë¶„ë„ ì˜®ê²¨ì¤˜ì•¼ í•œë‹¤. ê·¸ë ‡ê²Œ ë˜ë©´ init.js íŒŒì¼ì—ì„œ appì´ í•„ìš”í•˜ë¯€ë¡œ server.jsì—ì„œ export í•˜ê³ , init.jsì—ì„œ import í•´ì•¼ í•œë‹¤. ê·¸ëŸ¬ë¯€ë¡œ init.js íŒŒì¼ê³¼ server.js íŒŒì¼ì€ ë‹¤ìŒì²˜ëŸ¼ ë°”ë€ë‹¤.

```
// init.js
import "./db";
import "./models/Video";
import app from "./server";

const PORT = 4000;

const handleListening = () => {
  console.log(`âœ… Server listenting on http://localhost:${PORT} ğŸš€`);
}

app.listen(PORT, handleListening);
```

```
// server.js
import express from "express";
import morgan from "morgan";
import globalRouter from "./routers/globalRouter";
import videoRouter from "./routers/videoRouter";
import userRouter from "./routers/userRouter";

const app = express();
const logger = morgan("dev");

app.use("/videos", videoRouter);
app.use("/users", userRouter);

export default app;
```

ë˜í•œ ì‹œì‘í•˜ëŠ” íŒŒì¼ì„ ë‚˜ëˆ ì¤¬ê¸° ë•Œë¬¸ì—, server.jsë¡œ ì‹œì‘í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ init.jsë¡œ ì‹œì‘í•´ì•¼ í•œë‹¤. ê·¸ëŸ¬ë¯€ë¡œ package.json íŒŒì¼ì—ì„œ ì‹œì‘íŒŒì¼ì„ ë³€ê²½ì‹œì¼œì¤€ë‹¤.

```
// package.json
...
  "scripts": {
    "dev": "nodemon --exec babel-node src/init.js"
  },
...
```

ì•ìœ¼ë¡œ ìš°ë¦¬ê°€ ë§Œë“  ì§„ì§œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´, ê°€ì§œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚­ì œí•˜ê² ë‹¤. ê°„ë‹¨íˆ ë§í•´ videoController.jsì— ìˆëŠ” videoì™€ ê´€ë ¨ëœ ì½”ë“œë¥¼ ëª¨ë‘ ì‚­ì œí•˜ë©´ ëœë‹¤. ë¹ˆ ë¶€ë¶„ì´ ë§ì§€ë§Œ ìš°ì„  ì•„ë˜ì²˜ëŸ¼ ëœë‹¤.

```
// videoController.js
export const home = (req, res) => {
  return res.render("home", { pageTitle: "Home" });
};
export const watch = (req, res) => {
  const { id } = req.params;
  return res.render("watch", { pageTitle: `Watching` });
};
export const getEdit = (req, res) => {
  const { id } = req.params;
  return res.render("edit", { pageTitle: `Editing` });
};
export const postEdit = (req, res) => {
  const { id } = req.params;
  const { title } = req.body;
  return res.redirect(`/videos/${id}`);
};

export const getUpload = (req, res) => {
  return res.render("upload", { pageTitle: "Upload Video" });
};

export const postUpload = (req, res) => {
  const { title } = req.body;
  return res.redirect("/");
};
```

ì—¬ê¸°ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ íŒŒì¼ì„ importí•´ì£¼ê² ë‹¤. ê·¸ë¦¬ê³  trending ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì´ë¦„ì„ homeìœ¼ë¡œ ë°”ê¾¼ë‹¤. globalRouterì˜ trendingë„ homeìœ¼ë¡œ ë°”ê¿”ì•¼ í•˜ëŠ” ê²ƒì„ ìŠì§€ë§ì. ê·¸ë¦¬ê³  home íŒŒì¼ì— ë¹„ë””ì˜¤ë¥¼ ê°€ì ¸ì˜¤ê¸°ìœ„í•´ findë¥¼ ì‚¬ìš©í–ˆë‹¤.

```
// videoController.js
import Video from "../models/Video";

export const home = (req, res) => {
  Video.find({}, (error, videos) => {});
  return res.render("home", { pageTitle: "Home" });
};
...
```

mongooseëŠ” ë‹¤ì–‘í•œ [Queries](https://mongoosejs.com/docs/queries.html)ë¥¼ ì‚¬ìš©í•œë‹¤. ë§í¬ë¥¼ ë”°ë¼ê°€ë©´ CRUDë¥¼ ë³¼ ìˆ˜ ìˆë‹¤. ê·¸ì¤‘ì—ì„œ find í€´ë¦¬ë¥¼ ì‚´í´ë³´ê² ë‹¤. í˜•íƒœëŠ” Model.find([filter] [,projection] [,options] [,callback])ì˜ ëª¨ì–‘ì´ë‹¤. filterëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë°ì´í„°ë§Œì„ ë¶ˆëŸ¬ì˜¤ëŠ” ê¸°ëŠ¥ì´ë‹¤. ì•„ì§ ìš°ë¦¬ëŠ” ì–´ë–¤ ê²ƒë„ í•„í„°ë§ í•˜ê³  ì‹¶ì§€ ì•Šìœ¼ë¯€ë¡œ {}ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ê·¸ ì™¸ì˜ ì¡°ê±´ì€ ìš°ì„ ì€ ë„˜ê¸°ê³  ì½œë°± í•¨ìˆ˜ë¥¼ ë³´ê² ë‹¤. ì½œë°±í•¨ìˆ˜ëŠ” err, docsë¼ëŠ” ë§¤ê°œë³€ìˆ˜ê°€ ìˆëŠ”ë°, errëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ ì—ëŸ¬ë¥¼ ì˜ë¯¸í•˜ê³ , docsëŠ” ëª¨ë¸ì˜ ì»¬ë ‰ì…˜ì„ ì˜ë¯¸í•œë‹¤. ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” ëª¨ë¸ì€ videoê³  ê·¸ ì»¬ë ‰ì…˜ì€ videosê°€ ë˜ë¯€ë¡œ, docsëŠ” videosê°€ ëœë‹¤.

### 6.12 Our First Query part Two
ì´ë²ˆì—ëŠ” errorì™€ videosë¥¼ ì½˜ì†”ì— ì¶œë ¥ì‹œì¼œë³´ê² ë‹¤. ê·¸ ì „ì— home.pugì—ì„œ videosë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— res.renderì— videosë¥¼ ë³´ë‚´ì¤˜ì•¼ í•œë‹¤. ìš°ì„ ì€ ë¹„ì–´ìˆëŠ” arrayë¡œ ë³´ë‚´ì£¼ê² ë‹¤.

```
// videoController.js
import Video from "../models/Video";

export const home = (req, res) => {
  Video.find({}, (error, videos) => {
    console.log("errors", error);
    console.log("videos", videos);
  });
  return res.render("home", { pageTitle: "Home", videos: [] });
};
```

ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³  ì½˜ì†”ì„ í™•ì¸í•´ë³´ë©´ errorsëŠ” null, videosëŠ” []ê°€ ë‚˜ì˜¨ë‹¤. ì¦‰, ì•„ë¬´ëŸ° ì—ëŸ¬ ì—†ì´ ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ ì„ ì„±ê³µí–ˆë‹¤. ë¬¼ë¡  ì•„ë¬´ëŸ° ë¹„ë””ì˜¤ê°€ ì—†ìœ¼ë‹ˆ ì•„ë¬´ëŸ° ì¼ë„ í•˜ì§„ ì•Šì§€ë§Œ, ê·¸ë˜ë„ ì‘ë™ì€ í•œë‹¤. ìš°ë¦¬ëŠ” Video.findì˜ videosë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ë¯€ë¡œ ë§ˆì§€ë§‰ ì¤„ì˜ videos: []ë¥¼ ê·¸ëƒ¥ videosë¡œ ìˆ˜ì •í•´ì£¼ì.

ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ê¸° ì „ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ì•Œì•„ë³´ì. ëŸ°íƒ€ì„ì´ë€ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì‹œê°„, ë˜ëŠ” ê³µê°„ì„ ë§í•œë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” Node.jsê°€ ë‚˜ì˜¤ê¸° ì „ì—ëŠ” ìµìŠ¤í”Œë¡œì–´, íŒŒì´ì–´í­ìŠ¤, í¬ë¡¬ ê°™ì€ ì›¹ ë¸Œë¼ìš°ì €ë§Œì´ ëŸ°íƒ€ì„ìœ¼ë¡œ ì‚¬ìš©ë˜ì—ˆë‹¤. ë¸Œë¼ìš°ì €ì˜ ëŸ°íƒ€ì„ì€ í¬ê²Œ 4ê°€ì§€ ìš”ì†Œë¡œ êµ¬ì„±ëœë‹¤.

- JavaScript Engine: í™ ë©”ëª¨ë¦¬, ì½œ ìŠ¤íƒì„ í¬í•¨í•˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ í•´ì„ ì—”ì§„
- WebAPI: DOM ì¡°ì‘, ë„¤íŠ¸ì›Œí¬ ìš”ì²­, ì‘ë‹µ ë“±ì˜ ë¸Œë¼ìš°ì € ê¸°ëŠ¥
- Callback Queue: WebAPIì—ì„œ ì „ë‹¬ë°›ì€ ì½œë°± í•¨ìˆ˜ ì €ì¥
- Event Loop: ì½œ ìŠ¤íƒì´ ë¹Œë•Œë§ˆë‹¤, ì½œë°±íì—ì„œ ì½œë°±í•¨ìˆ˜ë¥¼ ì½œìŠ¤íƒìœ¼ë¡œ í•˜ë‚˜ì”© ì˜®ê¸´ë‹¤.

ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹±ê¸€ ì“°ë ˆë“œ ì–¸ì–´ë¡œ í•œ ë²ˆì— í•œ ê°€ì§€ ì¼ë§Œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤. ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ì¼ì€ ìŠ¤íƒìœ¼ë¡œ ìŒ“ì•„ì„œ ë§Œë“œëŠ”ë° ì‘ì—…ì„ í•˜ë‚˜ë°–ì— ì²˜ë¦¬í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œ ì „ì²´ê°€ ë©ˆì¶”ê³  ê²°ê³¼ê°€ ë‚˜ì™€ì•¼ ë‹¤ì‹œ ì‹œì‘ëœë‹¤. ê·¸ëŸ°ë° ì‘ì—…ì´ êµ‰ì¥íˆ ì˜¤ë˜ ê±¸ë¦¬ê²Œ ë˜ë©´ ë¬¸ì œê°€ ìƒê¸´ë‹¤. ë³´í†µ ë¸Œë¼ìš°ì €ëŠ” 60í”„ë ˆì„ì¸ë° ë§Œì•½ 16ms ì•ˆì— ì‘ì—…ì´ ëë‚˜ì§€ ì•Šìœ¼ë©´ ë¸Œë¼ìš°ì €ê°€ ëŠê²¨ì„œ ë³´ì´ê²Œ ëœë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì‘ì—…ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì¼ì€ ë¹„ë™ê¸° í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì„œ WebAPIë¡œ ë³´ë‚´ì„œ ì¼ì„ ëŒ€ì‹  ì‹œí‚¤ê³  ê²°ê³¼ë¥¼ ë°›ì•„ì˜¤ê²Œ ëœë‹¤.

ì½œë°±ì€ ë¹„ë™ê¸°ì ì¸ í•¨ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ë©´ ì´ë¥¼ WebAPIë¡œ ë³´ë‚¸ë‹¤. WebAPIëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì œê³µí•˜ëŠ” APIë¡œ ì½œìŠ¤íƒì—ì„œ ë¶ˆëŸ¬ì˜¨ í•¨ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ëŠ”ë°, WebAPIëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì™€ ë‹¬ë¦¬ ì‹±ê¸€ ìŠ¤ë ˆë“œê°€ ì•„ë‹ˆë‹¤. WebAPIëŠ” ë©€í‹° ìŠ¤ë ˆë“œë¡œ ë™ì‹œì— ì—¬ëŸ¬ê°€ì§€ ì¼ì„ ì²˜ë¦¬í•œë‹¤. í•˜ì§€ë§Œ ë©€í‹° ìŠ¤ë ˆë“œì˜ íŠ¹ì„±ìƒ ì¼ì²˜ë¦¬ì˜ ëë‚˜ëŠ” ìˆœì„œê°€ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤. ëë‚œ ì‘ì—…ì€ ìˆœì„œëŒ€ë¡œ ì½œë°±íì— ìŒ“ì´ê²Œ ëœë‹¤. ê·¸ë¦¬ê³  ë§Œì•½ ì½œìŠ¤íƒì´ ë¹„ì–´ìˆë‹¤ë©´ ì´ë²¤íŠ¸ë£¨í”„ê°€ ì½œë°±íì˜ ì‘ì—…ì„ ì½œìŠ¤íƒìœ¼ë¡œ ì˜®ê²¨ì¤€ë‹¤. 

ê²°ë¡ ì ìœ¼ë¡œ ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‘ì—…ì„ ì½œìŠ¤íƒì— ì˜¬ë¦¬ê³  ë¹„ë™ê¸° í•¨ìˆ˜ë“¤ì€ WebAPIì— ìœ„ì„í–ˆë‹¤ê°€ ê²°ê³¼ë¥¼ ë°›ì•„ì™€ì„œ ì‹¤í–‰í•˜ê²Œ ëœë‹¤. ê·¸ ë•Œë¬¸ì— ì‘ì—… ìˆœì„œì— ë³€í™”ê°€ ìƒê¸°ê¸°ë„ í•œë‹¤. ë‹¤ìŒ ì½”ë“œë¥¼ í™•ì¸í•´ë³´ì.

```
// videoController.js
import Video from "../models/Video";

export const home = (req, res) => {
  Video.find({}, (error, videos) => {
    console.log("errors", error);
    console.log("videos", videos);
  });
  console.log("hello");
  return res.render("home", { pageTitle: "Home", videos: [] });
};
```

ì´ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ìˆœì„œëŒ€ë¡œ errors, videos ë‹¤ìŒì— helloê°€ ë‚˜ì™€ì•¼ í•  ê²ƒ ê°™ë‹¤. ê·¸ëŸ°ë° ì‹¤í–‰í•´ë³´ë©´ helloê°€ ë¨¼ì € ì˜¤ê²Œ ëœë‹¤. ì´ëŠ” Video.find()ê°€ ë¹„ë™ê¸° í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì´ë‹¤. ì¦‰ Video.find()ë¥¼ ì‹¤í–‰í•˜ë©´ ì´ë¥¼ WebAPIì— ë„˜ê²¨ì£¼ê³  ë‹¤ë¥¸ ì‘ì—…ë“¤ì„ ì‹¤í–‰í•˜ë‹¤ê°€ Video.find()ì˜ ê²°ê³¼ë¥¼ ë°›ì•„ì˜¤ëŠ” ê²ƒì´ë‹¤. íŠ¹íˆ ì´ë•Œ ë¬¸ì œê°€ ìƒê¸°ëŠ” ë¶€ë¶„ì€ returnì´ë‹¤. ìš°ë¦¬ëŠ” Video.find()ì—ì„œ videosë¥¼ ë°›ì•„ì™€ì„œ res.renderì— ë„˜ê²¨ì£¼ê³  ì‹¶ë‹¤. ê·¸ëŸ°ë° ë¹„ë™ê¸°í™” ë•Œë¬¸ì— ìƒê°í•œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” returnì„ Video.find() ì•ˆì— ë„£ì–´ì¤˜ì•¼ í•œë‹¤. ì´ëŸ° ì¼ì„ ì¢…ì¢… ë°œìƒí•˜ê²Œ ë˜ëŠ”ë°, ì´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ ì½œë°±í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤. ë‹¤ìŒì— í•˜ê³  ì‹¶ì€ ì¼ì„ ì½œë°±í•¨ìˆ˜ë¡œ ë„£ì–´ì¤˜ì„œ ì‘ì—…ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ê²Œ ë§Œë“œëŠ” ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ í•˜ë©´ ì½œë°± ì§€ì˜¥ì´ë€ê²Œ ë°œìƒí•˜ëŠ”ë°, ì½œë°±í•¨ìˆ˜ë¥¼ ë„ˆë¬´ ë§ì´ ì‚¬ìš©í•´ì„œ ì½”ë“œë¥¼ ë„ì €íˆ ì•Œì•„ë³¼ ìˆ˜ ì—†ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ë‹¤ìŒ ì½”ë“œë¥¼ ë³´ì.

```
step1(function (err, value1) {
    if (err) {
        console.log(err);
        return;
    }
    step2(function (err, value2) {
        if (err) {
            console.log(err);
            return;
        }
        step3(function (err, value3) {
            if (err) {
                console.log(err);
                return;
            }
            step4(function (err, value4) {
                ...
            });
        });
    });
});
```
ìœ„ëŠ” step1 -> step2 -> step3 ... ìˆœì„œë¡œ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ë ¤ê³  ë§Œë“  ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  ì‚¬ì´ì‚¬ì´ ì—ëŸ¬ê°€ ë°œìƒˆì•Ÿë©´ ë©ˆì¶”ë„ë¡ ë§Œë“¤ì—ˆë‹¤. ë³´ë‹¤ì‹œí”¼ ë³„ê±° ì•„ë‹Œ ì½”ë“œì„ì—ë„ êµ‰ì¥íˆ ê°€ë…ì„±ì´ ë–¨ì–´ì§„ë‹¤. ê·¸ëŸ°ë° ì´ëŸ° ì½”ë“œê°€ ëª‡ ê°œë‚˜ ìŒ“ì´ê²Œ ë˜ë©´ ë„ì €íˆ ì´í•´í•  ìˆ˜ ì—†ëŠ” ì½”ë“œê°€ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒì´ë‹¤. ì´ë¥¼ ê³ ì¹˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒì— ë°°ì›Œë³´ê² ë‹¤.

### 6.13 Async Await
ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ async í•¨ìˆ˜ë¡œ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” function() ì•ì— async í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•œë‹¤. asyncëŠ” await í‚¤ì›Œë“œê°€ ë¹„ë™ê¸° ì½”ë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°, ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë™ê¸° í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ì¤€ë‹¤. ì´ì „ì˜ home ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ async/awaitë¥¼ ì‚¬ìš©í•´ì„œ ë§Œë“¤ì–´ë³´ê² ë‹¤.

```
// videoController.js
...
export const home = async (req, res) => {
  console.log("start");
  const videos = await Video.find({});
  console.log("finish");
  return res.render("home", {pageTitle: "Home", videos});
};
```

ë³´ë‹¤ì‹œí”¼ ì›ë˜ ë¹„ë™ê¸° í•¨ìˆ˜ì˜€ë˜ Video.find() ì•ì— awaitë¥¼ ë¶™ì˜€ë‹¤. ê·¸ë¦¬ê³  ì‘ë™ ìˆœì„œë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ console.logë¡œ ëª‡ ê°€ì§€ ì¶œë ¥ì„ í•´ì£¼ì—ˆë‹¤. awaitì„ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì„ ë•ŒëŠ” Video.find()ê°€ ì œì¼ ë§ˆì§€ë§‰ì— ì‹¤í–‰ë¬ì—ˆë‹¤. í•˜ì§€ë§Œ ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ì½”ë“œì˜ ìˆœì„œëŒ€ë¡œ ì‘ë™í•œë‹¤. ì¦‰ async/awaitì„ ì“°ë©´ ì½”ë“œê°€ ìˆœì„œëŒ€ë¡œ ì‘ë™í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ì´ëŠ” ìš°ë¦¬ì—ê²Œ êµ‰ì¥íˆ ì§ê´€ì ì¸ ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ì½”ë“œ ì‘ì„±ì´ íš¨ìœ¨ì ì´ê²Œ ëœë‹¤. 

ê·¸ëŸ°ë° ê¸°ì¡´ Video.find()ëŠ” ì½œë°±í•¨ìˆ˜ë¡œ (err, docs)ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í–ˆë‹¤. ìœ„ì˜ ì½”ë“œë¥¼ ë³´ë©´ videosë¥¼ docsë¡œ ë°›ì•„ì˜¤ëŠ” ê²ƒì€ ì•Œ ìˆ˜ ìˆì§€ë§Œ err ì²˜ë¦¬ ë¶€ë¶„ì´ ì—†ë‹¤. ì´ëŠ” try catchë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ì•„ë˜ì²˜ëŸ¼ ê°€ëŠ¥í•˜ë‹¤.

```
// videoController.js
...
export const home = async (req, res) => {
  try {
    const videos = await Video.find({});
    return res.render("home", {pageTitle: "Home", videos});
  } catch(error) {
    return res.render("server-error", { error });
  }
};
```

ìœ„ì˜ ì½”ë“œë¥¼ ë³´ë©´ ë¨¼ì € tryë¥¼ ì‹¤í–‰í•œë‹¤. ê·¸ëŸ¬ë‹¤ê°€ awaitì—ì„œ errê°€ ë°œìƒí•˜ë©´ ë°‘ì˜ catch(error)ì—ì„œ errì„ errorë¡œ ë°›ì•„ë“¤ì—¬ì„œ ì‚¬ìš©í•˜ê²Œ ëœë‹¤. ìœ„ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ "server-error"ë¼ëŠ” í˜ì´ì§€ê°€ ì—´ë¦¬ë„ë¡ ë§Œë“¤ì—ˆë‹¤. ë§Œì•½ ì—ëŸ¬ë¥¼ ì‚¬ìš©í•  ìƒê°ì´ ì—†ë‹¤ë©´ errorì„ ë¹¼ê³  ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•  ìˆ˜ë„ ìˆë‹¤.

```
// videoController.js
...
export const home = async (req, res) => {
  try {
    const videos = await Video.find({});
    return res.render("home", {pageTitle: "Home", videos});
  } catch {
    return res.render("server-error");
  }
};
```

### 6.14 Returns and Renders
ì´ì „ì— ì‘ì„±í•œ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```
// videoController.js
export const home = async (req, res) => {
  const videos = await Video.find({});
  return res.render("home", { pageTitle: "Home", videos });
};
```

ì—¬ê¸°ì„œ ì„¤ëª…ì„ ìœ„í•´ì„œ ì½”ë“œë¥¼ ì ì‹œ ì•„ë˜ì²˜ëŸ¼ ê³ ì³ë³´ê² ë‹¤.

```
export const home = async (req, res) => {
  Video.find({}, (error, videos) => {
    return res.render("home", {pageTitle: "Home", videos });
  });
};
```
ê·¸ëŸ°ë° ì—¬ê¸°ì„œ returnì€ ì•„ë¬´ëŸ° ì¼ë„ í•˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ ì´ìœ ëŠ” returnì´ home ì†ì˜ í•¨ìˆ˜ì—ì„œ ì‚¬ìš©ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤. ì¦‰ home ë°”ë¡œ ì•„ë˜ì—ì„œ ì“°ì´ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ homeì€ ì•„ë¬´ëŸ° ë¦¬í„´ê°’ì´ ì—†ë‹¤. ì‹¤ì œë¡œ ìœ„ì˜ ì½”ë“œë¥¼ returnì„ ë¹¼ê³  ì‹¤í–‰í•˜ë”ë¼ë„ ì•„ë¬´ëŸ° ë¬¸ì œë„ ì—†ì´ ì‘ë™í•œë‹¤.

```
export const home = async (req, res) => {
  Video.find({}, (error, videos) => {
    res.render("home", {pageTitle: "Home", videos });
  });
};
```

ì´ë²ˆì—ëŠ” res.renderì„ 2ë²ˆ ì‚¬ìš©í•´ë³´ê² ë‹¤.

```
export const home = async (req, res) => {
  Video.find({}, (error, videos) => {
    res.render("home", {pageTitle: "Home", videos });
    res.render("home", {pageTitle: "Home", videos });
  });
};
```

ê·¸ëŸ°ë° ì´ë ‡ê²Œ í•˜ë©´ í™”ë©´ì€ ê·¸ëŒ€ë¡œ ì¶œë ¥ë˜ì§€ë§Œ ì½˜ì†”ì„ ë³´ë©´ ì—ëŸ¬ê°€ ë‚˜ì˜¨ë‹¤. ì´ëŠ” ëœë”ë§ ì´í›„ì— ë‹¤ì‹œ ëœë”ë§ì„ í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ìƒê¸°ëŠ” í˜„ìƒì´ë‹¤. ì—¬ê¸°ì„œ ìš°ë¦¬ê°€ returnì„ ì‚¬ìš©í–ˆë˜ ì´ìœ ê°€ ìˆë‹¤. returnì€ ì•„ë¬´ëŸ° ë°˜í™˜ê°’ì´ ì—†ì§€ë§Œ ì½”ë“œë¥¼ ì¢…ë£Œì‹œì¼œì£¼ëŠ” íš¨ê³¼ê°€ ìˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— res.renderì— returnì„ ë¶™ì—¬ì£¼ë©´ í™•ì‹¤í•˜ê²Œ ê·¸ ì½”ë“œê°€ ì¢…ë£Œë˜ì—ˆë‹¤ëŠ” ê²ƒì„ í™•ì‹ í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤. ìœ„ì˜ ì½”ë“œì—ì„œë„ ì²« ë²ˆì§¸ ëœë”ë§ì— returnì„ ë¶™ì—¬ì£¼ë©´ ì•„ë˜ ì½”ë“œëŠ” ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ìš°ë¦¬ëŠ” ëœë”ë§ì„ í•˜ëŠ” ê³³ì— returnì„ ë¶™ì—¬ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ ë§‰ì•„ì¤˜ì•¼ í•œë‹¤.

### 6.15 Creating a Video part One
ë¹„ë””ì˜¤ë¥¼ ì—…ë¡œë“œí•˜ëŠ” ë¶€ë¶„ì„ ê³ ì³ì„œ ë°ì´í„°ë¥¼ ì—…ë¡œë“œ í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ê² ë‹¤. upload.pugì˜ ì½”ë“œë¥¼ ê³ ì³ì„œ title, description, hashtagë¥¼ ì…ë ¥ë°›ë„ë¡ ë§Œë“¤ì–´ì¤€ë‹¤. ì´ë•Œ nameì„ ê¼­ ë¶™ì—¬ì„œ ë§Œë“¤ì–´ì•¼ ë°ì´í„°ê°€ ì „ë‹¬ë˜ê³  req.bodyë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒì„ ê¸°ì–µí•˜ì.

```
// upload.pug
extends base.pug

block content
    form(method="POST")
        input(placeholder="Title", required, type="text", name="title")
        input(placeholder="Description", required, type="text", name="description")
        input(placeholder="Hashtags, separated by comma.", required, type="text", name="hashtags")
        input(type="submit", value="Upload Video")
```

ë‹¤ìŒìœ¼ë¡œ ì´ë¥¼ ì‹¤ì œë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°›ì•„ì„œ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ë³´ê² ë‹¤. upload.pugì—ì„œ ì „ë‹¬ëœ ë°ì´í„°ëŠ” ë¼ìš°í„°ë¥¼ ê±°ì³ì„œ postUpload ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‚¬ìš©í•œë‹¤. ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ `const { title, decsription, hashtags } = req.body;`ë¡œ ë°›ì•„ì¤€ë‹¤. ê·¸ í›„ ìš°ë¦¬ê°€ ë§Œë“  Video ìŠ¤í‚¤ë§ˆì— ë§ì¶°ì„œ documentë¥¼ ë§Œë“¤ì–´ì¤˜ì•¼ í•œë‹¤. ì—¬ê¸°ì„œ documentëŠ” ë°ì´í„°ë¥¼ ê°€ì§„ ë¹„ë””ì˜¤ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤. documentë¥¼ ë§Œë“¤ ë•Œ, `title: title`ì´ë¼ê³  ì ì–´ì£¼ë©´ titleì— req.body.titleì´ ë“¤ì–´ê°€ëŠ”ë°, ìœ„ì¹˜ë§Œ ê°™ë‹¤ë©´ ì´ë¥¼ ê°„ë‹¨íˆ titleë¡œë„ ì ì–´ì¤˜ë„ ëœë‹¤.

```
// videoController.js
...
export const postUpload = (req, res) => {
  const { title, description, hashtags } = req.body;
  const video = new Video({
    title: title,           // or you can use title,
    description: description,
    createdAt: Date.now(),
    hashtags: hashtags.split(",").map((word) => `#${word}`),
    meta: {
      views: 0,
      rating: 0,
    },
  });
  console.log(video);
  return res.redirect("/");
};
```

ì´ë•Œ createdAtì—ëŠ” í˜„ì¬ ì‹œê°„ì´ ë“¤ì–´ê°€ì•¼ í•˜ë¯€ë¡œ Date.now()ë¥¼ ì‚¬ìš©í–ˆê³ , metaì—ì„œ views, ratingì€ 0ìœ¼ë¡œ ë§Œë“¤ì—ˆë‹¤. ê·¸ëŸ°ë° hashtagsëŠ” string í˜•íƒœë¡œ ë“¤ì–´ì˜¤ëŠ”ë°, ìš°ë¦¬ê°€ ì‘ì„±í•œ ìŠ¤í‚¤ë§ˆì—ì„œëŠ” stringì˜ arrayë¡œ ë§Œë“¤ì—ˆìœ¼ë¯€ë¡œ ì´ë¥¼ splitìœ¼ë¡œ ë‚˜ëˆ ì¤˜ì•¼ í•œë‹¤. `hashtags.split(",")`ë¥¼ ì‚¬ìš©í•´ì„œ ,ë¥¼ ê¸°ì¤€ìœ¼ë¡œ hashtagsë¥¼ ë‚˜ëˆ ì¤€ë‹¤. ê·¸ í›„ #ì„ ë¶™ì—¬ì•¼ í•˜ë¯€ë¡œ ```.map( (word) => `#${word}`)```ë¥¼ ì‚¬ìš©í•´ì„œ ê¸€ì ì•ì— #ì„ ë§Œë“ ë‹¤. ì´ë ‡ê²Œ í•œ í›„ì— console.log(video)ë¡œ ìš°ë¦¬ê°€ ë§Œë“  ë¹„ë””ì˜¤ë¥¼ í™•ì¸í•´ë³´ë©´ ëœë‹¤.

ì—¬ê¸°ê¹Œì§€ ì‘ì„±í–ˆìœ¼ë©´ ë¹„ë””ì˜¤ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ì—…ë¡œë“œë¥¼ ëˆ„ë¥¸ë‹¤. ê·¸ë ‡ê²Œ í•˜ë©´ ì½˜ì†”ì—ì„œ ìš°ë¦¬ê°€ ì˜¬ë¦° ë¹„ë””ì˜¤ì˜ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤. ê·¸ëŸ°ë° ì—¬ê¸°ì„œ ìš°ë¦¬ê°€ ì‚¬ìš©í•œì  ì—†ëŠ” _idë¼ëŠ” ê²ƒì´ ìˆëŠ”ë° ì´ëŠ” ëª½êµ¬ìŠ¤ê°€ ë§Œë“¤ì–´ì¤€ ê²ƒìœ¼ë¡œ, í˜„ì¬ëŠ” ì´ëŸ° ê²ƒì´ ìˆë‹¤ëŠ” ê²ƒë§Œ ê¸°ì–µí•˜ë©´ ëœë‹¤. ê·¸ëŸ°ë° ì•„ì§ì€ ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì´ ì—†ìœ¼ë¯€ë¡œ í™ˆí™”ë©´ì—ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ë‹¤.

### 6.16 Creating a Video part Two
ë°ì´í„°ë¥¼ ì •í•´ì§„ ìë£Œí˜•ê³¼ ë‹¤ë¥¸ ê²ƒì„ ë„£ìœ¼ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ìˆ«ìë¥¼ ë„£ìœ¼ë©´ stringìœ¼ë¡œ ë°”ê¿”ì„œ ë„£ì–´ì£¼ê²Œ ëœë‹¤. ê·¸ë ‡ë‹¤ë©´ ìˆ«ìë¥¼ ë„£ì–´ì¤˜ì•¼ í•˜ëŠ” ë¶€ë¶„ì— stringì„ ë„£ìœ¼ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ë°ì´í„°ëŠ” ì˜ëª» ë„£ì€ ë¶€ë¶„ì„ ì œì™¸í•˜ê³  ë§Œë“¤ì–´ì§„ë‹¤. ì´ëŠ” ìš°ë¦¬ê°€ ìŠ¤í‚¤ë§ˆë¥¼ ë§Œë“  ì´ìœ ë¡œ ìë£Œí˜•ì— ë§ì§€ ì•Šì€ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ë©´ ì´ë¥¼ ì•Œì•„ì„œ ì²˜ë¦¬í•´ì¤€ë‹¤. ë³€í™˜í•  ìˆ˜ ìˆë‹¤ë©´ ë³€í™˜í•´ì£¼ê³  ì•„ë‹ˆë¼ë©´ ë¬´ì‹œí•˜ê³  ì§„í–‰í•˜ëŠ” ê²ƒì´ë‹¤.

ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ëŠ” ê²ƒì€ ê°„ë‹¨í•˜ë‹¤. ìš°ë¦¬ì˜ ë°ì´í„°ëŠ” video ì´ë¯€ë¡œ `video.save()`ë¥¼ í•´ì£¼ë©´ ëœë‹¤. ì´ë•Œ saveëŠ” promiseë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ async/awaitë¥¼ ì‚¬ìš©í•´ì„œ ì €ì¥ë˜ëŠ” ê²ƒì„ ê¸°ë‹¤ë ¤ì¤˜ì•¼ í•œë‹¤.

```
// videoController.js
...
export const postUpload = async (req, res) => {
  const { title, description, hashtags } = req.body;
  const video = new Video({
    title,
    description,
    createdAt: Date.now(),
    hashtags: hashtags.split(",").map((word) => `#${word}`),
    meta: {
      views: 0,
      rating: 0,
    },
  });
  await video.save();
  return res.redirect("/");
};
```

ì—¬ê¸°ì„œ Video.createë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„ì˜ ì½”ë“œì™€ ì™„ì „íˆ ë™ì¼í•œ ì—­í• ì„ í•˜ëŠ” ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

```
// videoController.js
...
export const postUpload = async (req, res) => {
  const { title, description, hashtags } = req.body;
  await Video.create({
    title,
    description,
    createdAt: Date.now(),
    hashtags: hashtags.split(",").map((word) => `#${word}`),
    meta: {
      views: 0,
      rating: 0,
    },
  });
  return res.redirect("/");
};
```

ë‘˜ì˜ ì°¨ì´ì ì€ í•˜ë‚˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“  ë‹¤ìŒì— ì €ì¥í•˜ëŠ” ê²ƒì´ê³ , Video.createëŠ” ì´ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤€ë‹¤ëŠ” ì  ë¿ì´ë‹¤. ê·¸ëŸ°ë° ì €ì¥í•˜ëŠ” ìë£Œê°€ ì˜ëª»ëœ ë°ì´í„°ê°€ ë“¤ì–´ìˆìœ¼ë©´, ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹  ë¸Œë¼ìš°ì €ê°€ ì €ì¥ì„ ê³„ì† ê¸°ë‹¤ë¦¬ê²Œ ëœë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì´ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„  try catchë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•´ì¤˜ì•¼ í•œë‹¤.

### 6.17 Exceptions and Validation

### 6.18 More Schema

### 6.19 Video Detail

### 6.20 Edit Video part One

### 6.21 Edit Video part Two

### 6.22 Edit Video part Three

### 6.23 Middlewares

### 6.24 Statics

### 6.25 Delete Video

### 6.26 Search part One

### 6.27 Search part Two

### 6.28 Colclusions